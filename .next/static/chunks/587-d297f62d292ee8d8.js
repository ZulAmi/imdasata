"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[587],{7187:function(e){var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise(function(r,i){var n;function s(r){e.removeListener(t,o),i(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&(n={once:!0},"function"==typeof e.on&&y(e,"error",s,n))})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,i){if(a(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=u(e))>0&&o.length>n&&!o.warned){o.warned=!0;var n,s,o,l=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,console&&console.warn&&console.warn(l)}return e}function c(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=c.bind(i);return n.listener=r,i.wrapFn=n,n}function d(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):f(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=Array(t),i=0;i<t;++i)r[i]=e[i];return r}function y(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function n(s){i.once&&e.removeEventListener(t,n),r(s)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var o,a=Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=s[e];if(void 0===u)return!1;if("function"==typeof u)i(u,this,t);else for(var l=u.length,c=f(u,l),r=0;r<l;++r)i(c[r],this,t);return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,o;if(a(t),void 0===(i=this._events)||void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},1587:function(e,t,r){r.d(t,{M:function(){return s}});var i=r(7187);class n extends i.EventEmitter{registerUser(e){let t={language:"en",country:"unknown",interests:[],timezone:"UTC",availableTimes:["evening"],experienceLevel:"newcomer",supportPreferences:{communicationStyle:"flexible",topicsOfInterest:[],triggerWarnings:[]},trustScore:50,totalBuddyPoints:0,buddyHistory:[],joinedAt:new Date,lastActive:new Date,isActive:!0,privacySettings:{shareLocation:!1,sharePersonalInfo:!1,allowVoiceMessages:!0},...e};return this.users.set(t.id,t),this.emit("userRegistered",t),this.addToMatchingQueue(t.id),t}updateUserPreferences(e,t){let r=this.users.get(e);return!!r&&(r.supportPreferences={...r.supportPreferences,...t},this.users.set(e,r),this.emit("userPreferencesUpdated",r),!0)}calculateCompatibilityScore(e,t){let r=0,i={language:.25,timezone:.15,interests:.2,experienceLevel:.15,communicationStyle:.1,availableTimes:.1,ageRange:.05};e.language===t.language&&(r+=100*i.language);let n=Math.max(0,100-10*Math.abs(this.getTimezoneOffset(e.timezone)-this.getTimezoneOffset(t.timezone)));r+=i.timezone*n;let s=Math.min(100,e.interests.filter(e=>t.interests.includes(e)).length/Math.max(e.interests.length,t.interests.length,1)*100);r+=i.interests*s;let o=["newcomer","experienced","veteran"],a=o.indexOf(e.experienceLevel),u=o.indexOf(t.experienceLevel);r+=i.experienceLevel*Math.max(0,100-25*Math.abs(a-u)),(e.supportPreferences.communicationStyle===t.supportPreferences.communicationStyle||"flexible"===e.supportPreferences.communicationStyle||"flexible"===t.supportPreferences.communicationStyle)&&(r+=100*i.communicationStyle);let l=e.availableTimes.filter(e=>t.availableTimes.includes(e)).length/Math.max(e.availableTimes.length,t.availableTimes.length,1)*100;if(r+=i.availableTimes*l,e.supportPreferences.ageRange&&t.supportPreferences.ageRange){let[n,s]=e.supportPreferences.ageRange,[o,a]=t.supportPreferences.ageRange,u=Math.max(s,a)-Math.min(n,o);r+=i.ageRange*(u>0?Math.max(0,Math.min(s,a)-Math.max(n,o))/u*100:100)}return Math.round(r)}getTimezoneOffset(e){return({UTC:0,GMT:0,EST:-5,PST:-8,CST:-6,MST:-7,JST:9,SGT:8,IST:5.5,CET:1,EET:2})[e]||0}findBestMatch(e){let t=this.users.get(e);if(!t||t.currentBuddyId)return null;let r=null,i=0;for(let[n,s]of this.users){if(n===e||s.currentBuddyId||!s.isActive||t.buddyHistory.includes(n)||t.supportPreferences.preferredGender&&"any"!==t.supportPreferences.preferredGender&&s.supportPreferences.preferredGender!==t.supportPreferences.preferredGender)continue;let o=this.calculateCompatibilityScore(t,s);o>i&&o>=60&&(i=o,r=s)}return r}createBuddyPair(e,t){let r=this.users.get(e),i=this.users.get(t);if(!r||!i||r.currentBuddyId||i.currentBuddyId)return null;let n="pair_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),s=this.calculateCompatibilityScore(r,i),o={id:n,user1Id:e,user2Id:t,pairedAt:new Date,lastInteraction:new Date,interactionCount:0,compatibilityScore:s,status:"active",checkInFrequency:"weekly",sharedGoals:[],conversationStarters:this.getPersonalizedStarters(r,i),points:{user1Points:0,user2Points:0,totalSharedPoints:0}};return r.currentBuddyId=t,i.currentBuddyId=e,r.buddyHistory.push(t),i.buddyHistory.push(e),this.pairs.set(n,o),this.interactions.set(n,[]),this.users.set(e,r),this.users.set(t,i),this.emit("buddyPairCreated",o),o}addToMatchingQueue(e){this.matchingQueue.includes(e)||(this.matchingQueue.push(e),this.processMatchingQueue())}processMatchingQueue(){if(this.matchingQueue.length<2)return;let e=new Set;for(let t of[...this.matchingQueue]){if(e.has(t))continue;let r=this.users.get(t);if(!r||r.currentBuddyId||!r.isActive){this.matchingQueue=this.matchingQueue.filter(e=>e!==t);continue}let i=this.findBestMatch(t);i&&!e.has(i.id)&&this.createBuddyPair(t,i.id)&&(e.add(t),e.add(i.id),this.matchingQueue=this.matchingQueue.filter(e=>e!==t&&e!==i.id))}}recordInteraction(e,t){let r={id:"int_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:new Date,...t},i=this.interactions.get(e)||[];i.push(r),this.interactions.set(e,i);let n=this.pairs.get(e);if(n){n.lastInteraction=new Date,n.interactionCount++;let i=this.calculateInteractionPoints(r);t.initiatorId===n.user1Id?n.points.user1Points+=i:n.points.user2Points+=i,n.points.totalSharedPoints+=i;let s=this.users.get(t.initiatorId);s&&(s.totalBuddyPoints+=i,this.users.set(t.initiatorId,s)),this.pairs.set(e,n)}return this.emit("interactionRecorded",r),r}calculateInteractionPoints(e){let t;return t=10+(e.quality-1)*5+(({"check-in":5,"voice-call":15,"text-chat":8,"goal-update":12,emergency:20})[e.type]||0),e.duration&&(t+=Math.min(20,Math.floor(e.duration/5))),e.mood.after>e.mood.before&&(t+=(e.mood.after-e.mood.before)*2),t}initializeConversationStarters(){this.conversationStarters=[{id:"check-in-1",category:"check-in",text:"How has your week been treating you? Any highlights or challenges?",followUpQuestions:["What made that moment special/difficult for you?","How did you handle that situation?","What would you do differently next time?"],culturallySensitive:!0,experienceLevel:"all"},{id:"goal-1",category:"goal-setting",text:"What's one small thing you'd like to accomplish this week?",followUpQuestions:["What steps could help you get there?","What might get in the way?","How can I support you with this goal?"],culturallySensitive:!0,experienceLevel:"all"},{id:"coping-1",category:"coping-strategies",text:"What's something that always helps you feel a bit better when you're down?",followUpQuestions:["When did you first discover this helps?","Have you tried sharing this with others?","Are there variations of this that work too?"],culturallySensitive:!0,experienceLevel:"experienced"},{id:"cultural-1",category:"cultural-exchange",text:"What's a tradition or custom from your background that brings you comfort?",followUpQuestions:["How do you maintain this tradition here?","Have you adapted it to your new environment?","Would you like to share this with others?"],culturallySensitive:!0,experienceLevel:"all"},{id:"light-1",category:"light-hearted",text:"If you could have any superpower for just one day, what would you choose?",followUpQuestions:["What would you do first with that power?","How would you use it to help others?","What would be the funniest way to use it?"],culturallySensitive:!0,experienceLevel:"all"},{id:"newcomer-1",category:"check-in",text:"What's been the most surprising thing about settling in here?",followUpQuestions:["How different was it from what you expected?","What has helped you adjust?","What do you miss most from home?"],culturallySensitive:!0,experienceLevel:"newcomer"}]}getPersonalizedStarters(e,t){return this.conversationStarters.filter(r=>"all"===r.experienceLevel||r.experienceLevel===e.experienceLevel||r.experienceLevel===t.experienceLevel).slice(0,5).map(e=>e.text)}getConversationStarter(e,t){let r=this.pairs.get(e);if(!r)return null;let i=this.users.get(r.user1Id),n=this.users.get(r.user2Id);if(!i||!n)return null;let s=this.conversationStarters.filter(e=>(!t||e.category===t)&&("all"===e.experienceLevel||e.experienceLevel===i.experienceLevel||e.experienceLevel===n.experienceLevel));0===s.length&&(s=this.conversationStarters.filter(e=>"all"===e.experienceLevel));let o=Math.floor(Math.random()*s.length);return s[o]||null}scheduleNextCheckIn(e){let t=this.pairs.get(e);if(!t)return;let r=new Date,i=new Date(r);switch(t.checkInFrequency){case"daily":i.setDate(r.getDate()+1);break;case"weekly":i.setDate(r.getDate()+7);break;case"biweekly":i.setDate(r.getDate()+14)}t.nextScheduledCheckIn=i,this.pairs.set(e,t),this.emit("checkInScheduled",{pairId:e,nextCheckIn:i})}getDueCheckIns(){let e=new Date;return Array.from(this.pairs.values()).filter(t=>"active"===t.status&&t.nextScheduledCheckIn&&t.nextScheduledCheckIn<=e)}reportUser(e){let t="report_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),r={id:t,timestamp:new Date,status:"pending",...e};return this.reports.set(t,r),this.emit("safetyReportFiled",r),"critical"===r.severity&&this.handleCriticalReport(r),r}handleCriticalReport(e){let t=this.users.get(e.reportedUserId);if(t&&(t.isActive=!1,this.users.set(e.reportedUserId,t),t.currentBuddyId)){let r=this.findPairByUsers(e.reportedUserId,t.currentBuddyId);r&&this.endBuddyPair(r,"report")}this.emit("criticalReportHandled",e)}endBuddyPair(e,t){let r=this.pairs.get(e);if(!r)return!1;r.status="ended",r.endReason=t;let i=this.users.get(r.user1Id),n=this.users.get(r.user2Id);return i&&(i.currentBuddyId=void 0,this.users.set(r.user1Id,i),"report"!==t&&i.isActive&&this.addToMatchingQueue(r.user1Id)),n&&(n.currentBuddyId=void 0,this.users.set(r.user2Id,n),"report"!==t&&n.isActive&&this.addToMatchingQueue(r.user2Id)),this.pairs.set(e,r),this.emit("buddyPairEnded",{pairId:e,reason:t}),!0}requestNewBuddy(e,t){let r=this.users.get(e);if(!r||!r.currentBuddyId)return!1;let i=this.findPairByUsers(e,r.currentBuddyId);return!!i&&(this.endBuddyPair(i,"reassignment"),this.emit("newBuddyRequested",{userId:e,reason:t}),!0)}findPairByUsers(e,t){for(let[r,i]of this.pairs)if(i.user1Id===e&&i.user2Id===t||i.user1Id===t&&i.user2Id===e)return r;return null}getUserStats(e){let t=this.users.get(e);if(!t)return null;let r=Array.from(this.interactions.values()).flat().filter(t=>t.initiatorId===e),i=t.currentBuddyId?Array.from(this.pairs.values()).find(t=>t.user1Id===e||t.user2Id===e):null;return{totalPoints:t.totalBuddyPoints,trustScore:t.trustScore,totalInteractions:r.length,averageInteractionQuality:r.length>0?r.reduce((e,t)=>e+t.quality,0)/r.length:0,buddyHistory:t.buddyHistory.length,currentBuddyPairedAt:null==i?void 0:i.pairedAt,daysWithCurrentBuddy:i?Math.floor((Date.now()-i.pairedAt.getTime())/864e5):0}}getPairStats(e){let t=this.pairs.get(e),r=this.interactions.get(e)||[];if(!t)return null;let i=this.users.get(t.user1Id),n=this.users.get(t.user2Id);return{compatibilityScore:t.compatibilityScore,daysTogether:Math.floor((Date.now()-t.pairedAt.getTime())/864e5),totalInteractions:r.length,averageQuality:r.length>0?r.reduce((e,t)=>e+t.quality,0)/r.length:0,totalSharedPoints:t.points.totalSharedPoints,lastInteractionDaysAgo:t.lastInteraction?Math.floor((Date.now()-t.lastInteraction.getTime())/864e5):null,checkInFrequency:t.checkInFrequency,nextCheckIn:t.nextScheduledCheckIn,user1:i?{name:i.name,points:t.points.user1Points}:null,user2:n?{name:n.name,points:t.points.user2Points}:null}}startPeriodicTasks(){setInterval(()=>{this.checkInactivePairs()},36e5),setInterval(()=>{this.processMatchingQueue()},3e5),setInterval(()=>{this.sendCheckInReminders()},864e5)}checkInactivePairs(){let e=new Date;for(let[t,r]of this.pairs)"active"===r.status&&e.getTime()-r.lastInteraction.getTime()>6048e5&&this.endBuddyPair(t,"timeout")}sendCheckInReminders(){for(let e of this.getDueCheckIns())this.emit("checkInReminder",e)}getUser(e){return this.users.get(e)}getPair(e){return this.pairs.get(e)}getUserPair(e){return Array.from(this.pairs.values()).find(t=>t.user1Id===e||t.user2Id===e)}getPairInteractions(e){return this.interactions.get(e)||[]}getActiveUsers(){return Array.from(this.users.values()).filter(e=>e.isActive)}getActivePairs(){return Array.from(this.pairs.values()).filter(e=>"active"===e.status)}getPendingReports(){return Array.from(this.reports.values()).filter(e=>"pending"===e.status)}constructor(){super(),this.users=new Map,this.pairs=new Map,this.interactions=new Map,this.reports=new Map,this.conversationStarters=[],this.matchingQueue=[],this.initializeConversationStarters(),this.startPeriodicTasks()}}let s=new n}}]);