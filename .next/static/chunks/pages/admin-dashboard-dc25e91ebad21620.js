(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[897],{5809:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin-dashboard",function(){return s(6760)}])},6760:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(5893),r=s(7294),i=s(1664),n=s.n(i);function l(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)([]),[l,d]=(0,r.useState)(!0),[o,c]=(0,r.useState)("30"),[m,x]=(0,r.useState)("all"),[h,g]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{"true"===localStorage.getItem("adminAuthenticated")&&g(!0)},[]),(0,r.useEffect)(()=>{h&&p()},[o,m,h]),!h)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"You need to be authenticated to access the analytics dashboard."}),(0,a.jsx)(n(),{href:"/admin-login",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors",children:"Go to Admin Login"})]})});let p=async()=>{d(!0);try{let e=new Date().toISOString(),s=new Date(Date.now()-864e5*parseInt(o)).toISOString(),a=new URLSearchParams({type:"dashboard-summary",startDate:s,endDate:e});"all"!==m&&a.append("country",m);let r=await fetch("/api/analytics/phq4?".concat(a)),n=await r.json();t(n);let l=u(n);i(l)}catch(e){console.error("Error fetching dashboard data:",e)}d(!1)},u=e=>{let t=[];return e.patterns.highRiskPercentage>30&&t.push({type:"warning",title:"High Risk Population Alert",message:"".concat(e.patterns.highRiskPercentage.toFixed(1),"% of assessments indicate high risk levels"),priority:"high",timestamp:new Date().toISOString()}),e.patterns.interventionTriggers.immediateIntervention.length>0&&t.push({type:"critical",title:"Immediate Intervention Required",message:"".concat(e.patterns.interventionTriggers.immediateIntervention.length," users require immediate support"),priority:"critical",timestamp:new Date().toISOString()}),e.completion.overallCompletionRate<70&&t.push({type:"info",title:"Low Completion Rate",message:"Assessment completion rate is ".concat(e.completion.overallCompletionRate.toFixed(1),"%"),priority:"medium",timestamp:new Date().toISOString()}),e.trends.overallTrends.scoreChange>10&&t.push({type:"warning",title:"Increasing Mental Health Concerns",message:"Average scores have increased by ".concat(e.trends.overallTrends.scoreChange.toFixed(1),"%"),priority:"high",timestamp:new Date().toISOString()}),t},b=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{let t=new URLSearchParams({type:"export-data",includeMetadata:e.toString()});"all"!==m&&t.append("country",m);let s=await fetch("/api/analytics/phq4?".concat(t)),a=await s.blob(),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download="phq4-export-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}catch(e){console.error("Error exporting data:",e)}};return l?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading analytics dashboard..."})]})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"PHQ-4 Analytics Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mt-1",children:"Mental Health Assessment Analytics & Insights"})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("adminAuthenticated"),window.location.href="/admin-login"},className:"bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded text-sm font-medium transition-colors",children:"Logout"}),(0,a.jsx)(n(),{href:"/dashboard",className:"text-blue-600 hover:text-blue-800 text-sm",children:"Back to App"}),(0,a.jsxs)("select",{value:o,onChange:e=>c(e.target.value),className:"border rounded px-3 py-1 text-sm",children:[(0,a.jsx)("option",{value:"7",children:"Last 7 days"}),(0,a.jsx)("option",{value:"30",children:"Last 30 days"}),(0,a.jsx)("option",{value:"90",children:"Last 90 days"})]}),(0,a.jsxs)("select",{value:m,onChange:e=>x(e.target.value),className:"border rounded px-3 py-1 text-sm",children:[(0,a.jsx)("option",{value:"all",children:"All Countries"}),Object.keys(e.demographics.byCountry).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s.length>0&&(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"⚠️ Alerts & Notifications"}),(0,a.jsx)("div",{className:"space-y-3",children:s.map((e,t)=>(0,a.jsx)("div",{className:"border-l-4 p-4 rounded-r-lg ".concat("critical"===e.type?"bg-red-50 border-red-500 text-red-800":"warning"===e.type?"bg-yellow-50 border-yellow-500 text-yellow-800":"bg-blue-50 border-blue-500 text-blue-800"),children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm mt-1",children:e.message})]}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat("critical"===e.priority?"bg-red-200 text-red-800":"high"===e.priority?"bg-orange-200 text-orange-800":"medium"===e.priority?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"),children:e.priority})]})},t))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Total Assessments"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-800",children:e.trends.totalAssessments.toLocaleString()}),(0,a.jsxs)("p",{className:"text-sm text-green-600 mt-2",children:["+",e.trends.overallTrends.participationGrowth.toFixed(1),"% growth"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Completion Rate"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-gray-800",children:[e.completion.overallCompletionRate.toFixed(1),"%"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Avg. time: ",Math.round(e.completion.averageCompletionTime),"s"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"High Risk Users"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600",children:e.patterns.totalHighRisk}),(0,a.jsxs)("p",{className:"text-sm text-red-600 mt-2",children:[e.patterns.highRiskPercentage.toFixed(1),"% of completed"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Countries Served"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:Object.keys(e.demographics.byCountry).length}),(0,a.jsxs)("p",{className:"text-sm text-blue-600 mt-2",children:[Object.keys(e.demographics.byLanguage).length," languages"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Risk Level Distribution"}),(0,a.jsx)("div",{className:"space-y-4",children:e.visualizations.scoreDistribution.datasets[0].data.map((t,s)=>{let r=e.visualizations.scoreDistribution.labels[s],i=e.visualizations.scoreDistribution.datasets[0].backgroundColor[s],n=e.trends.totalAssessments>0?(t/e.trends.totalAssessments*100).toFixed(1):"0";return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded mr-3",style:{backgroundColor:i}}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:r})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-800",children:t}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",n,"%)"]})]})]},s)})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Top Countries by Risk"}),(0,a.jsx)("div",{className:"space-y-3",children:Object.entries(e.demographics.byCountry).sort((e,t)=>{let[,s]=e,[,a]=t;return a.riskDistribution.severe+a.riskDistribution.moderate-(s.riskDistribution.severe+s.riskDistribution.moderate)}).slice(0,5).map(e=>{let[t,s]=e,r=s.riskDistribution.severe+s.riskDistribution.moderate;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:t}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-800",children:[s.totalAssessments," assessments"]}),(0,a.jsxs)("span",{className:"text-xs ml-2 px-2 py-1 rounded ".concat(r>50?"bg-red-100 text-red-800":r>30?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[r,"% high risk"]})]})]},t)})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Language Usage"}),(0,a.jsx)("div",{className:"space-y-3",children:Object.entries(e.demographics.byLanguage).sort((e,t)=>{let[,s]=e,[,a]=t;return a.totalAssessments-s.totalAssessments}).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:{en:"English",zh:"Chinese",bn:"Bengali",ta:"Tamil",my:"Burmese",idn:"Indonesian"}[t]||t}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-800",children:s.totalAssessments}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",s.completionRate.toFixed(1),"% completion)"]})]})]},t)})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Intervention Triggers"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border-l-4 border-red-500 pl-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-red-800",children:"Immediate Intervention"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:e.patterns.interventionTriggers.immediateIntervention.length}),(0,a.jsx)("p",{className:"text-xs text-red-600",children:"users requiring urgent support"})]}),(0,a.jsxs)("div",{className:"border-l-4 border-yellow-500 pl-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-yellow-800",children:"Follow-up Required"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:e.patterns.interventionTriggers.followUpRequired.length}),(0,a.jsx)("p",{className:"text-xs text-yellow-600",children:"users for follow-up care"})]}),(0,a.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-blue-800",children:"Monitoring List"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:e.patterns.interventionTriggers.monitoringList.length}),(0,a.jsx)("p",{className:"text-xs text-blue-600",children:"users for continued monitoring"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Recent Trends"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Score Change"}),(0,a.jsxs)("p",{className:"text-2xl font-bold ".concat(e.trends.overallTrends.scoreChange>0?"text-red-600":"text-green-600"),children:[e.trends.overallTrends.scoreChange>0?"+":"",e.trends.overallTrends.scoreChange.toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Participation Growth"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["+",e.trends.overallTrends.participationGrowth.toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Avg Completion Time"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-800",children:[Math.round(e.completion.averageCompletionTime),"s"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Data Export & Research"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,a.jsx)("button",{onClick:()=>b(!0),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"Export Full Dataset (with metadata)"}),(0,a.jsx)("button",{onClick:()=>b(!1),className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors",children:"Export Basic Dataset"}),(0,a.jsx)("button",{onClick:p,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors",children:"\uD83D\uDD04 Refresh Data"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:"All exported data is anonymized and PDPA compliant. Research use requires institutional ethics approval."})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-8 text-center",children:[(0,a.jsx)("p",{className:"text-red-600",children:"Error loading dashboard data"}),(0,a.jsx)("button",{onClick:p,className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Retry"})]})})}}},function(e){e.O(0,[664,888,774,179],function(){return e(e.s=5809)}),_N_E=e.O()}]);