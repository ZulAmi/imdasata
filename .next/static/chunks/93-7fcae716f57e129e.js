"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[93],{9093:function(e,t,a){class r{async getRecommendations(e){let{userProfile:t,context:a,abTestGroup:r}=e,s=this.getRecommendationStrategy(t,r),i=[];switch(s){case"content-based":i=await this.getContentBasedRecommendations(t,a);break;case"collaborative":i=await this.getCollaborativeRecommendations(t,a);break;case"demographic":i=await this.getDemographicRecommendations(t,a);break;case"ml-predicted":i=await this.getMLPredictedRecommendations(t,a);break;default:i=await this.getHybridRecommendations(t,a)}return i=(i=this.applyContextFilters(i,a)).sort((e,t)=>t.score-e.score).slice(0,a.maxRecommendations),i=this.addPersonalizedMessages(i,t),this.logRecommendationMetrics(i,t,s,r),i}async getContentBasedRecommendations(e,t){let a=[],r=e.phq4Scores.latest;for(let t of this.resources){var s,i,o;let n=0,l=[];t.metadata.riskLevels.includes(r.riskLevel)&&(n+=.3,l.push("Suitable for ".concat(r.riskLevel," risk level"))),t.metadata.languages.includes(e.demographics.language)&&(n+=.2,l.push("Available in ".concat(e.demographics.language)));let c=e.demographics.countryOfOrigin;c&&t.metadata.culturalContext.includes(c)&&(n+=.15,l.push("Culturally appropriate for ".concat(c)));let d=t.metadata.targetDemographics;(null===(s=d.ageGroups)||void 0===s?void 0:s.includes(e.demographics.ageGroup||""))&&(n+=.1,l.push("Age-appropriate content")),(null===(i=d.employmentSectors)||void 0===i?void 0:i.includes(e.demographics.employmentSector||""))&&(n+=.1,l.push("Relevant to your work situation"));let u=null===(o=e.demographics.location)||void 0===o?void 0:o.country;u&&t.availability.locations.includes(u)&&(n+=.15,l.push("Available in your location")),n>.3&&a.push({resource:t,score:n,reasons:l,strategy:"content-based",urgency:this.calculateUrgency(r.riskLevel,t.type),estimatedHelpfulness:this.estimateHelpfulness(t,e)})}return a}async getCollaborativeRecommendations(e,t){let a=[],r=this.findSimilarUsers(e),s=new Map;for(let e of r){let t=e.similarity;for(let a of e.profile.interactionHistory)if("rate"===a.type&&a.rating&&a.rating>=4){let e=s.get(a.resourceId)||{score:0,count:0,reasons:new Set};e.score+=a.rating/5*t,e.count+=1,e.reasons.add("Highly rated by users with similar background"),s.set(a.resourceId,e)}}for(let[t,r]of s.entries()){let s=this.resources.find(e=>e.id===t);if(s&&r.count>=3){let t=r.score/r.count;a.push({resource:s,score:t,reasons:Array.from(r.reasons),strategy:"collaborative",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,s.type),estimatedHelpfulness:t})}}return a}async getDemographicRecommendations(e,t){let a=[],r=e.demographics;for(let t of this.resources){var s,i,o,n;let l=0,c=[];r.countryOfOrigin&&(null===(s=t.metadata.targetDemographics.countries)||void 0===s?void 0:s.includes(r.countryOfOrigin))&&(l+=.3,c.push("Designed for ".concat(r.countryOfOrigin," nationals"))),r.employmentSector&&(null===(i=t.metadata.targetDemographics.employmentSectors)||void 0===i?void 0:i.includes(r.employmentSector))&&(l+=.25,c.push("Tailored for ".concat(r.employmentSector," workers"))),r.ageGroup&&(null===(o=t.metadata.targetDemographics.ageGroups)||void 0===o?void 0:o.includes(r.ageGroup))&&(l+=.2,c.push("Appropriate for your age group")),r.gender&&(null===(n=t.metadata.targetDemographics.genders)||void 0===n?void 0:n.includes(r.gender))&&(l+=.15,c.push("Gender-specific content")),t.metadata.languages.includes(r.language)&&(l+=.1,c.push("Available in ".concat(r.language))),l>.4&&a.push({resource:t,score:l,reasons:c,strategy:"demographic",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,t.type),estimatedHelpfulness:this.estimateHelpfulness(t,e)})}return a}async getMLPredictedRecommendations(e,t){let a=[],r=this.extractUserFeatures(e);for(let t of this.resources){let s=this.extractResourceFeatures(t),i=this.predictResourceFit(r,s);i.score>.5&&a.push({resource:t,score:i.score,reasons:i.reasons,strategy:"ml-predicted",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,t.type),estimatedHelpfulness:i.score})}return a}async getHybridRecommendations(e,t){let a=await this.getContentBasedRecommendations(e,t),r=await this.getCollaborativeRecommendations(e,t),s=await this.getDemographicRecommendations(e,t),i=await this.getMLPredictedRecommendations(e,t),o=new Map;for(let e of[...a.map(e=>({...e,strategy:"content-based"})),...r.map(e=>({...e,strategy:"collaborative"})),...s.map(e=>({...e,strategy:"demographic"})),...i.map(e=>({...e,strategy:"ml-predicted"}))]){let t=e.resource.id,a=o.get(t)||{resource:e.resource,scores:{},reasons:new Set};a.scores[e.strategy]=e.score,e.reasons.forEach(e=>a.reasons.add(e)),o.set(t,a)}let n=[],l={"content-based":.3,collaborative:.25,demographic:.2,"ml-predicted":.25};for(let[t,a]of o.entries()){let t=0,r=0;for(let[e,s]of Object.entries(a.scores)){let a=l[e]||0;t+=s*a,r+=a}r>0&&(t/=r,n.push({resource:a.resource,score:t,reasons:Array.from(a.reasons),strategy:"hybrid",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,a.resource.type),estimatedHelpfulness:t}))}return n}findSimilarUsers(e){let t=[];for(let[a,r]of this.userProfiles.entries()){if(r.anonymousId===e.anonymousId)continue;let a=this.calculateUserSimilarity(e,r);a>.3&&t.push({profile:r,similarity:a})}return t.sort((e,t)=>t.similarity-e.similarity).slice(0,20)}calculateUserSimilarity(e,t){let a;return a=0+(1-Math.abs(e.phq4Scores.latest.totalScore-t.phq4Scores.latest.totalScore)/12)*.3,e.demographics.countryOfOrigin===t.demographics.countryOfOrigin&&(a+=.2),e.demographics.ageGroup===t.demographics.ageGroup&&(a+=.15),e.demographics.employmentSector===t.demographics.employmentSector&&(a+=.15),e.demographics.language===t.demographics.language&&(a+=.1),e.demographics.gender===t.demographics.gender&&(a+=.1),Math.min(a,1)}extractUserFeatures(e){return[e.phq4Scores.latest.totalScore/12,e.phq4Scores.latest.depressionScore/6,e.phq4Scores.latest.anxietyScore/6,e.usagePatterns.assessmentFrequency/10,e.usagePatterns.totalSessions/100,e.usagePatterns.sessionDuration/60,this.encodeRiskLevel(e.phq4Scores.latest.riskLevel),this.encodeCategory(e.demographics.ageGroup||"",["18-25","26-35","36-45","46-55","55+"]),this.encodeCategory(e.demographics.countryOfOrigin||"",["Bangladesh","India","Philippines","Indonesia","Myanmar"])]}extractResourceFeatures(e){return[e.effectiveness.averageRating/5,e.effectiveness.completionRate,e.effectiveness.improvementScore/12,e.metadata.duration/120,this.encodeCategory(e.metadata.difficulty,["beginner","intermediate","advanced"]),this.encodeCategory(e.type,["therapy","self-help","peer-support","medication","crisis","wellness"])]}predictResourceFit(e,t){let a=0,r=[];e[3]>.7&&t[5]>.8&&(a+=.4,r.push("Matched based on urgency indicators"));let s=e[4],i=t[4];s>.5&&i>.6&&(a+=.2,r.push("Suitable complexity for active users"));let o=t[0];return a+=.3*o,o>.8&&r.push("Highly effective based on user feedback"),{score:Math.min(a+=.1*Math.random(),1),reasons:r}}calculateUrgency(e,t){return"severe"===e&&"crisis"===t?"urgent":"severe"===e?"high":"moderate"===e?"medium":"low"}estimateHelpfulness(e,t){let a=e.effectiveness.averageRating/5,r=t.phq4Scores.latest.riskLevel;return e.metadata.riskLevels.includes(r)&&(a+=.2),e.metadata.languages.includes(t.demographics.language)&&(a+=.1),Math.min(a,1)}encodeRiskLevel(e){return({minimal:.25,mild:.5,moderate:.75,severe:1})[e]||0}encodeCategory(e,t){let a=t.indexOf(e);return a>=0?(a+1)/t.length:0}getRecommendationStrategy(e,t){if(!t)return"hybrid";let a=Array.from(this.abTests.values()).find(e=>e.active&&e.trafficSplit[t]);return a&&a.variants[t]?a.variants[t].strategy:"hybrid"}applyContextFilters(e,t){var a,r;let s=e;if((null===(a=t.includeTypes)||void 0===a?void 0:a.length)&&(s=s.filter(e=>t.includeTypes.includes(e.resource.type))),(null===(r=t.excludeTypes)||void 0===r?void 0:r.length)&&(s=s.filter(e=>!t.excludeTypes.includes(e.resource.type))),t.urgencyFilter){let e={low:1,medium:2,high:3,urgent:4},a=e[t.urgencyFilter];s=s.filter(t=>e[t.urgency]>=a)}return s}addPersonalizedMessages(e,t){return e.map(e=>{t.phq4Scores.latest.riskLevel;let a=t.demographics.countryOfOrigin,r="";return"urgent"===e.urgency?r="This resource provides immediate support for your current situation.":"collaborative"===e.strategy?r="People with similar backgrounds have found this helpful.":"demographic"===e.strategy&&a?r="This resource is specifically designed for people from ".concat(a,"."):e.resource.effectiveness.averageRating>4.5&&(r="This is a highly-rated resource that has helped many people."),{...e,personalizedMessage:r}})}logRecommendationMetrics(e,t,a,r){e.forEach((e,s)=>{let i={recommendationId:"rec_".concat(Date.now(),"_").concat(s),userId:t.anonymousId,timestamp:new Date().toISOString(),strategy:a,abTestGroup:r,resourceId:e.resource.id,score:e.score,position:s,viewed:!1,clicked:!1,completed:!1,triggerContext:"system_generated",userRiskLevel:t.phq4Scores.latest.riskLevel,timeOfDay:new Date().getHours().toString()};this.metrics.push(i)})}trackInteraction(e,t,a){let r=this.metrics.find(t=>t.recommendationId===e);if(r)switch(t){case"view":r.viewed=!0;break;case"click":r.clicked=!0,r.timeToClick=null==a?void 0:a.timeToClick;break;case"complete":r.completed=!0,r.engagementDuration=null==a?void 0:a.duration;break;case"rate":r.rating=null==a?void 0:a.rating,r.helpfulnessRating=null==a?void 0:a.helpfulness}}initializeResources(){this.resources=[{id:"res_001",type:"therapy",title:"Multilingual Counseling Services",description:"Professional counseling available in multiple languages for migrant workers",metadata:{languages:["en","zh","bn","ta","my","idn"],culturalContext:["Bangladesh","India","Philippines","Indonesia","Myanmar"],targetDemographics:{employmentSectors:["Construction","Domestic Work","Manufacturing"],countries:["Singapore","Malaysia","UAE","Saudi Arabia"]},riskLevels:["moderate","severe"],tags:["professional","culturally-sensitive","confidential"],difficulty:"beginner",duration:60,format:"individual"},effectiveness:{averageRating:4.3,totalRatings:127,completionRate:.78,improvementScore:3.2},availability:{locations:["Singapore","Malaysia","UAE"],cost:"free",accessRequirements:["appointment"],waitTime:3},provider:{name:"Migrant Mental Health Collective",type:"ngo",credentials:["Licensed Therapists","Cultural Specialists"],contact:{phone:"+65-1234-5678",email:"help@mmhc.org",whatsapp:"+65-1234-5678"}}}]}initializeABTests(){this.abTests.set("recommendation_strategy_test",{id:"recommendation_strategy_test",name:"Recommendation Strategy Comparison",description:"Testing different recommendation approaches",active:!0,trafficSplit:{control:25,ml_enhanced:25,cultural_first:25,collaborative_heavy:25},startDate:"2025-08-01",metrics:["click_through_rate","completion_rate","satisfaction_rating"],variants:{control:{strategy:"content-based",weights:{content:1},parameters:{}},ml_enhanced:{strategy:"ml-predicted",weights:{ml:.6,content:.4},parameters:{exploration_rate:.1}},cultural_first:{strategy:"demographic",weights:{demographic:.6,cultural:.4},parameters:{cultural_weight:2}},collaborative_heavy:{strategy:"hybrid",weights:{collaborative:.5,content:.3,demographic:.2},parameters:{min_similar_users:5}}}})}getAnalytics(e){let t=this.metrics;e&&(t=t.filter(t=>new Date(t.timestamp)>=new Date(e.start)&&new Date(t.timestamp)<=new Date(e.end)));let a=t.length,r=t.filter(e=>e.clicked).length,s=t.filter(e=>e.completed).length,i=new Map;for(let e of["content-based","collaborative","demographic","ml-predicted","hybrid"]){let a=t.filter(t=>t.strategy===e),r=a.filter(e=>e.clicked).length,s=a.filter(e=>e.completed).length,o=a.filter(e=>e.rating).reduce((e,t)=>e+(t.rating||0),0)/a.filter(e=>e.rating).length;i.set(e,{totalRecommendations:a.length,clickThroughRate:a.length>0?r/a.length:0,completionRate:a.length>0?s/a.length:0,averageRating:o||0})}return{overview:{totalRecommendations:a,clickThroughRate:a>0?r/a:0,completionRate:a>0?s/a:0},strategyPerformance:Object.fromEntries(i),abTestResults:this.getABTestResults()}}getABTestResults(){let e=new Map;for(let[t,a]of this.abTests.entries()){let r=this.metrics.filter(e=>e.abTestGroup),s=new Map;for(let e of Object.keys(a.variants)){let t=r.filter(t=>t.abTestGroup===e),a=t.filter(e=>e.clicked).length,i=t.filter(e=>e.completed).length;s.set(e,{sample_size:t.length,click_through_rate:t.length>0?a/t.length:0,completion_rate:t.length>0?i/t.length:0})}e.set(t,{test_name:a.name,status:a.active?"active":"inactive",variants:Object.fromEntries(s)})}return Object.fromEntries(e)}constructor(){this.resources=[],this.userProfiles=new Map,this.interactions=[],this.abTests=new Map,this.metrics=[],this.modelWeights={phq4ScoreWeight:.25,demographicWeight:.2,culturalWeight:.15,collaborativeWeight:.2,usagePatternWeight:.1,recencyWeight:.1},this.initializeResources(),this.initializeABTests()}}t.Z=r}}]);