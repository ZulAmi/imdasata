"use strict";(()=>{var e={};e.id=5124,e.ids=[5124],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9982:(e,t,r)=>{r.r(t),r.d(t,{config:()=>g,default:()=>u,routeModule:()=>p});var a={};r.r(a),r.d(a,{default:()=>m});var n=r(1802),i=r(7153),o=r(6249),s=r(2830),c=r(7673);let l=new s.Z,d=new c.Z;async function m(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{recommendationId:r,userId:a,interactionType:n,resourceId:i,data:o,testAssignment:s}=e.body;if(!r||!a||!n||!i)return t.status(400).json({error:"Missing required fields: recommendationId, userId, interactionType, resourceId"});if(["view","click","complete","rate"].includes(n)&&l.trackInteraction(r,n,o),s){let e=d.exportResults(s.testId).filter(e=>e.userId===a);if(e.length>0){let t=e[e.length-1],r={...t.secondaryMetrics};switch(n){case"click":t.recommendationsClicked+=1,r.click_through_rate=t.recommendationsClicked/t.recommendationsShown,o?.timeToInteraction&&(r.avg_time_to_click=o.timeToInteraction);break;case"complete":t.recommendationsCompleted+=1,r.completion_rate=t.recommendationsCompleted/Math.max(t.recommendationsClicked,1),o?.duration&&(t.sessionDuration+=o.duration,r.avg_engagement_duration=o.duration);break;case"rate":o?.rating&&(t.satisfactionRating=o.rating,r.satisfaction_rating=o.rating),o?.helpfulness&&(t.helpfulnessRating=o.helpfulness,r.helpfulness_rating=o.helpfulness);break;case"bookmark":r.bookmark_rate=(r.bookmark_rate||0)+1;break;case"share":r.share_rate=(r.share_rate||0)+1}d.recordResult({...t,secondaryMetrics:r,timestamp:new Date().toISOString()})}}let c={id:`interaction_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,recommendationId:r,userId:a,resourceId:i,type:n,timestamp:new Date().toISOString(),data:o||{},testAssignment:s||null};console.log("Interaction tracked:",c);let m={success:!0,interactionId:c.id,message:`${n} interaction tracked successfully`};switch(n){case"click":m.metrics={timeToClick:o?.timeToInteraction,resourceClicked:i};break;case"complete":m.metrics={completionTime:o?.duration,completionPercentage:o?.completionPercentage};break;case"rate":m.metrics={rating:o?.rating,helpfulness:o?.helpfulness},o?.rating&&o.rating<=2&&(m.suggestFollowUp=!0,m.message="Low rating detected. Consider showing alternative recommendations.")}return t.status(200).json(m)}catch(e){return console.error("Tracking API error:",e),e instanceof Error&&e.message,t.status(500).json({error:"Failed to track interaction",details:"Internal server error"})}}let u=(0,o.l)(a,"default"),g=(0,o.l)(a,"config"),p=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/track-interaction",pathname:"/api/track-interaction",bundlePath:"",filename:""},userland:a})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9174],()=>r(9982));module.exports=a})();