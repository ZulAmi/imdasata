"use strict";(()=>{var e={};e.id=6001,e.ids=[6001],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1872:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>g,routeModule:()=>p});var a={};r.r(a),r.d(a,{default:()=>m,generateAlerts:()=>d,processRealTimeMetrics:()=>u});var n=r(1802),i=r(7153),o=r(6249);class l{constructor(e){this.data=e}calculatePopulationTrends(e){let t=e?this.data.filter(t=>new Date(t.timestamp)>=new Date(e.start)&&new Date(t.timestamp)<=new Date(e.end)):this.data,r=Object.entries(this.groupByDate(t)).map(([e,t])=>{let r=t.filter(e=>e.isComplete),a=t.length,n=r.length>0?r.reduce((e,t)=>e+t.totalScore,0)/r.length:0,i=this.calculateRiskDistribution(r),o=a>0?r.length/a*100:0;return{date:e,totalAssessments:a,averageScore:Math.round(100*n)/100,riskDistribution:i,completionRate:Math.round(100*o)/100}}).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),a=this.calculateOverallTrends(r);return{totalAssessments:t.length,timeRange:e||{start:t.length>0?t[0].timestamp:new Date().toISOString(),end:new Date().toISOString()},trendData:r,overallTrends:a}}generateDemographicBreakdown(){let e=this.data.filter(e=>e.isComplete),t=this.groupBy(e,"countryOfOrigin"),r={};Object.entries(t).forEach(([e,t])=>{if(!e||"undefined"===e)return;let a=t.reduce((e,t)=>e+t.totalScore,0)/t.length,n=this.calculateRiskDistribution(t),i=[...new Set(t.map(e=>e.language))],o=[...new Set(t.map(e=>e.employmentSector).filter(Boolean))];r[e]={totalAssessments:t.length,averageScore:Math.round(100*a)/100,riskDistribution:n,commonLanguages:i,employmentSectors:o}});let a=this.groupBy(e,"language"),n={};Object.entries(a).forEach(([e,t])=>{let r=t.reduce((e,t)=>e+t.totalScore,0)/t.length,a=this.data.filter(t=>t.language===e),i=t.length/a.length*100,o=[...new Set(t.map(e=>e.countryOfOrigin).filter(Boolean))];n[e]={totalAssessments:t.length,averageScore:Math.round(100*r)/100,completionRate:Math.round(100*i)/100,topCountries:o.slice(0,5)}});let i=this.groupBy(e,"ageGroup"),o={};return Object.entries(i).forEach(([e,t])=>{if(!e||"undefined"===e)return;let r=t.reduce((e,t)=>e+t.totalScore,0)/t.length,a=this.calculateRiskDistribution(t);o[e]={totalAssessments:t.length,averageScore:Math.round(100*r)/100,riskDistribution:a}}),{byCountry:r,byLanguage:n,byAgeGroup:o}}trackCompletionMetrics(){let e=this.data.length,t=this.data.filter(e=>e.isComplete),r=t.length/e*100,a=t.filter(e=>e.completionTime).map(e=>e.completionTime);return{overallCompletionRate:Math.round(100*r)/100,averageCompletionTime:Math.round(a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0),dropoffPoints:{question1:25,question2:15,question3:10,question4:5},completionByDemographic:{byCountry:this.calculateCompletionByGroup("countryOfOrigin"),byLanguage:this.calculateCompletionByGroup("language"),byAgeGroup:this.calculateCompletionByGroup("ageGroup")},timeToComplete:{fast:a.filter(e=>e<30).length,normal:a.filter(e=>e>=30&&e<=120).length,slow:a.filter(e=>e>120).length}}}identifyHighRiskPatterns(){let e=this.data.filter(e=>e.isComplete&&("severe"===e.riskLevel||"moderate"===e.riskLevel)),t=e.length,r=t/this.data.filter(e=>e.isComplete).length*100,a=Object.entries(this.groupBy(e,"anonymousId")).filter(([e,t])=>t.length>1).map(([e,t])=>{let r=t.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).map(e=>e.totalScore),a=this.analyzeTrend(r);return{userId:e,assessmentCount:t.length,scoreProgression:r,trend:a}});return{totalHighRisk:t,highRiskPercentage:Math.round(100*r)/100,patterns:{repeatAssessments:a,demographicRiskFactors:this.calculateDemographicRiskFactors(),temporalPatterns:this.analyzeTemporalPatterns(e)},interventionTriggers:this.generateInterventionTriggers(e)}}createVisualizationData(){let e=this.data.filter(e=>e.isComplete),t={labels:["0-2","3-5","6-8","9-12"],datasets:[{label:"Score Distribution",data:[e.filter(e=>e.totalScore<=2).length,e.filter(e=>e.totalScore>=3&&e.totalScore<=5).length,e.filter(e=>e.totalScore>=6&&e.totalScore<=8).length,e.filter(e=>e.totalScore>=9).length],backgroundColor:["#10B981","#F59E0B","#EF4444","#DC2626"],borderColor:["#059669","#D97706","#DC2626","#B91C1C"]}]},r=this.groupByDate(e),a=Object.keys(r).sort(),n={labels:a,datasets:[{label:"Average Daily Score",data:a.map(e=>{let t=r[e];return t.reduce((e,t)=>e+t.totalScore,0)/t.length}),borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},i=[...new Set(e.map(e=>e.countryOfOrigin).filter(Boolean))],o=["minimal","mild","moderate","severe"],l={countries:i,riskLevels:o,data:i.map(t=>o.map(r=>e.filter(e=>e.countryOfOrigin===t&&e.riskLevel===r).length))},s=Array.from({length:24},(e,t)=>t.toString().padStart(2,"0")),m=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],u={hours:s,days:m,data:m.map(t=>s.map(r=>e.filter(e=>{let a=new Date(e.timestamp);return a.getDay()===m.indexOf(t)&&a.getHours()===parseInt(r)}).length))},d={Bangladesh:[23.685,90.3563],India:[20.5937,78.9629],Philippines:[12.8797,121.774],Indonesia:[-.7893,113.9213],Myanmar:[21.9162,95.956],Thailand:[15.87,100.9925],Vietnam:[14.0583,108.2772],Nepal:[28.3949,84.124],"Sri Lanka":[7.8731,80.7718]},g={};return Object.entries(this.groupBy(e,"countryOfOrigin")).forEach(([e,t])=>{if(!e||"undefined"===e||!d[e])return;let r=t.reduce((e,t)=>e+t.totalScore,0)/t.length;g[e]={totalAssessments:t.length,averageScore:Math.round(100*r)/100,riskLevel:r>=9?"severe":r>=6?"moderate":r>=3?"mild":"minimal",coordinates:d[e]}}),{scoreDistribution:t,trendLines:n,heatmaps:{riskByDemographic:l,temporalHeatmap:u},geographicData:g}}exportAnonymizedData(e=!0){let t=this.data.map(t=>{let r={assessmentId:t.id,totalScore:t.totalScore,depressionScore:t.depressionScore,anxietyScore:t.anxietyScore,riskLevel:t.riskLevel,language:t.language,timestamp:t.timestamp,isComplete:t.isComplete};return e?{...r,countryOfOrigin:t.countryOfOrigin,ageGroup:t.ageGroup,gender:t.gender,employmentSector:t.employmentSector,completionTime:t.completionTime}:r});return{metadata:{exportDate:new Date().toISOString(),totalRecords:t.length,completedAssessments:t.filter(e=>e.isComplete).length,dataFields:Object.keys(t[0]||{}),privacyNote:"All personal identifiers have been removed. Anonymous IDs are excluded to prevent re-identification.",ethicsApproval:"Data exported for research purposes under institutional ethics approval.",dataRetention:"Research data should be handled according to institutional data governance policies."},data:t}}groupBy(e,t){return e.reduce((e,r)=>{let a=String(r[t]||"unknown");return e[a]=e[a]||[],e[a].push(r),e},{})}groupByDate(e){return e.reduce((e,t)=>{let r=new Date(t.timestamp).toISOString().split("T")[0];return e[r]=e[r]||[],e[r].push(t),e},{})}calculateRiskDistribution(e){let t=e.length;return 0===t?{minimal:0,mild:0,moderate:0,severe:0}:{minimal:Math.round(e.filter(e=>"minimal"===e.riskLevel).length/t*100),mild:Math.round(e.filter(e=>"mild"===e.riskLevel).length/t*100),moderate:Math.round(e.filter(e=>"moderate"===e.riskLevel).length/t*100),severe:Math.round(e.filter(e=>"severe"===e.riskLevel).length/t*100)}}calculateOverallTrends(e){if(e.length<2)return{scoreChange:0,riskLevelChanges:{minimal:0,mild:0,moderate:0,severe:0},participationGrowth:0};let t=e[0],r=e[e.length-1],a=(r.averageScore-t.averageScore)/t.averageScore*100,n=(r.totalAssessments-t.totalAssessments)/t.totalAssessments*100;return{scoreChange:Math.round(100*a)/100,riskLevelChanges:{minimal:r.riskDistribution.minimal-t.riskDistribution.minimal,mild:r.riskDistribution.mild-t.riskDistribution.mild,moderate:r.riskDistribution.moderate-t.riskDistribution.moderate,severe:r.riskDistribution.severe-t.riskDistribution.severe},participationGrowth:Math.round(100*n)/100}}calculateCompletionByGroup(e){let t=this.groupBy(this.data,e),r={};return Object.entries(t).forEach(([e,t])=>{if("undefined"===e||!e)return;let a=t.filter(e=>e.isComplete).length/t.length*100;r[e]=Math.round(100*a)/100}),r}analyzeTrend(e){if(e.length<2)return"stable";let t=e[0],r=e[e.length-1]-t;return r>1?"worsening":r<-1?"improving":"stable"}calculateDemographicRiskFactors(){let e=this.data.filter(e=>e.isComplete),t=e.filter(e=>"severe"===e.riskLevel||"moderate"===e.riskLevel).length/e.length,r=[];return Object.entries(this.groupBy(e,"countryOfOrigin")).forEach(([e,a])=>{if(!e||"undefined"===e)return;let n=a.filter(e=>"severe"===e.riskLevel||"moderate"===e.riskLevel).length/a.length/t;n>1.2&&r.push({country:e,language:a[0].language,ageGroup:a[0].ageGroup||"unknown",riskMultiplier:Math.round(100*n)/100})}),r.sort((e,t)=>t.riskMultiplier-e.riskMultiplier)}analyzeTemporalPatterns(e){let t={},r={},a={},n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.forEach(e=>t[e]=0);for(let e=0;e<24;e++)r[e.toString().padStart(2,"0")]=0;return i.forEach(e=>a[e]=0),e.forEach(e=>{let o=new Date(e.timestamp),l=n[o.getDay()],s=o.getHours().toString().padStart(2,"0"),m=i[o.getMonth()];t[l]++,r[s]++,a[m]++}),{dayOfWeek:t,timeOfDay:r,seasonality:a}}generateInterventionTriggers(e){let t=e.filter(e=>"severe"===e.riskLevel),r=e.filter(e=>"moderate"===e.riskLevel),a=t.filter(e=>new Date(e.timestamp)>new Date(Date.now()-864e5)).map(e=>e.anonymousId),n=[...r.map(e=>e.anonymousId),...t.filter(e=>!a.includes(e.anonymousId)).map(e=>e.anonymousId)],i=Object.entries(this.groupBy(this.data.filter(e=>e.isComplete),"anonymousId")).filter(([e,t])=>{if(t.length<2)return!1;let r=t.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime());return"worsening"===this.analyzeTrend(r.map(e=>e.totalScore))}).map(([e])=>e);return{immediateIntervention:[...new Set(a)],followUpRequired:[...new Set(n)],monitoringList:[...new Set(i)]}}}let s=()=>{let e=["Bangladesh","India","Philippines","Indonesia","Myanmar","Thailand","Vietnam","Nepal","Sri Lanka"],t=["en","zh","bn","ta","my","idn"],r=["18-25","26-35","36-45","46-55","55+"],a=["Male","Female","Other","Prefer not to say"],n=["Construction","Domestic Work","Manufacturing","Healthcare","Hospitality","Agriculture"],i=[];for(let o=0;o<500;o++){let l;let s=new Date;s.setDate(s.getDate()-Math.floor(90*Math.random()));let m=Math.floor(4*Math.random()),u=Math.floor(4*Math.random()),d=Math.floor(4*Math.random()),g=Math.floor(4*Math.random()),h=m+u+d+g;l=h>=9?"severe":h>=6?"moderate":h>=3?"mild":"minimal";let p=Math.random()>.15;i.push({id:`assessment_${o}`,anonymousId:`anon_${Math.random().toString(36).substr(2,9)}`,totalScore:h,depressionScore:m+u,anxietyScore:d+g,riskLevel:l,language:t[Math.floor(Math.random()*t.length)],countryOfOrigin:e[Math.floor(Math.random()*e.length)],ageGroup:r[Math.floor(Math.random()*r.length)],gender:a[Math.floor(Math.random()*a.length)],employmentSector:n[Math.floor(Math.random()*n.length)],timestamp:s.toISOString(),completionTime:p?Math.floor(180*Math.random())+30:void 0,isComplete:p})}return i.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())};async function m(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{type:r,startDate:a,endDate:n,includeMetadata:i,country:o,language:m}=e.query,u=s();a&&n&&(u=u.filter(e=>{let t=new Date(e.timestamp);return t>=new Date(a)&&t<=new Date(n)})),o&&(u=u.filter(e=>e.countryOfOrigin===o)),m&&(u=u.filter(e=>e.language===m));let d=new l(u);switch(r){case"population-trends":let g=d.calculatePopulationTrends(a&&n?{start:a,end:n}:void 0);return t.status(200).json(g);case"demographic-breakdown":let h=d.generateDemographicBreakdown();return t.status(200).json(h);case"completion-metrics":let p=d.trackCompletionMetrics();return t.status(200).json(p);case"high-risk-patterns":let c=d.identifyHighRiskPatterns();return t.status(200).json(c);case"visualization-data":let f=d.createVisualizationData();return t.status(200).json(f);case"export-data":let y=d.exportAnonymizedData("true"===i);return t.setHeader("Content-Type","application/json"),t.setHeader("Content-Disposition",`attachment; filename="phq4-export-${new Date().toISOString().split("T")[0]}.json"`),t.status(200).json(y);case"dashboard-summary":let v={trends:d.calculatePopulationTrends(),demographics:d.generateDemographicBreakdown(),completion:d.trackCompletionMetrics(),patterns:d.identifyHighRiskPatterns(),visualizations:d.createVisualizationData()};return t.status(200).json(v);default:return t.status(400).json({error:"Invalid type parameter. Supported types: population-trends, demographic-breakdown, completion-metrics, high-risk-patterns, visualization-data, export-data, dashboard-summary"})}}catch(e){return console.error("Analytics API error:",e),t.status(500).json({error:"Internal server error",message:void 0})}}let u=e=>{let t=new Date,r=e.filter(e=>{let r=new Date(e.timestamp);return t.getTime()-r.getTime()<=864e5}),a=e.filter(e=>{let r=new Date(e.timestamp);return t.getTime()-r.getTime()<=6048e5});return{last24Hours:{total:r.length,completed:r.filter(e=>e.isComplete).length,highRisk:r.filter(e=>e.isComplete&&("severe"===e.riskLevel||"moderate"===e.riskLevel)).length},last7Days:{total:a.length,completed:a.filter(e=>e.isComplete).length,averageScore:a.filter(e=>e.isComplete).length>0?a.filter(e=>e.isComplete).reduce((e,t)=>e+t.totalScore,0)/a.filter(e=>e.isComplete).length:0}}},d=e=>{let t=new l(e),r=t.identifyHighRiskPatterns(),a=[];r.highRiskPercentage>30&&a.push({type:"warning",title:"High Risk Population Alert",message:`${r.highRiskPercentage.toFixed(1)}% of recent assessments indicate high risk levels`,priority:"high",timestamp:new Date().toISOString()}),r.interventionTriggers.immediateIntervention.length>0&&a.push({type:"critical",title:"Immediate Intervention Required",message:`${r.interventionTriggers.immediateIntervention.length} users require immediate mental health intervention`,priority:"critical",timestamp:new Date().toISOString()});let n=t.trackCompletionMetrics();return n.overallCompletionRate<70&&a.push({type:"info",title:"Low Completion Rate",message:`Assessment completion rate is ${n.overallCompletionRate.toFixed(1)}% - consider UX improvements`,priority:"medium",timestamp:new Date().toISOString()}),a},g=(0,o.l)(a,"default"),h=(0,o.l)(a,"config"),p=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/analytics/phq4",pathname:"/api/analytics/phq4",bundlePath:"",filename:""},userland:a})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=1872);module.exports=r})();