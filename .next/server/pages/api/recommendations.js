"use strict";(()=>{var e={};e.id=7731,e.ids=[7731],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3941:(e,t,r)=>{r.r(t),r.d(t,{config:()=>g,default:()=>l,routeModule:()=>p});var n={};r.r(n),r.d(n,{default:()=>c});var o=r(1802),a=r(7153),s=r(6249),i=r(2830),d=r(7673);let u=new i.Z,m=new d.Z;async function c(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{userProfile:r,context:n,requestId:o}=e.body;if(!r||!n)return t.status(400).json({error:"Missing required fields: userProfile and context"});let a=m.assignUserToTest(r.anonymousId,r),s={userProfile:r,context:n,abTestGroup:a?.variantId},i=await u.getRecommendations(s);return a&&m.recordResult({testId:a.testId,variantId:a.variantId,timestamp:new Date().toISOString(),userId:r.anonymousId,primaryMetric:i.length>0?1:0,secondaryMetrics:{num_recommendations:i.length,avg_score:i.reduce((e,t)=>e+t.score,0)/Math.max(i.length,1),high_urgency_count:i.filter(e=>"high"===e.urgency||"urgent"===e.urgency).length},userRiskLevel:r.phq4Scores.latest.riskLevel,userCountry:r.demographics.location?.country||"unknown",userEmploymentSector:r.demographics.employmentSector||"unknown",userLanguage:r.demographics.language,recommendationsShown:i.length,recommendationsClicked:0,recommendationsCompleted:0,sessionDuration:0}),t.status(200).json({success:!0,recommendations:i,metadata:{requestId:o||`req_${Date.now()}`,abTestGroup:a?.variantId,totalRecommendations:i.length,strategy:i[0]?.strategy||"none",timestamp:new Date().toISOString()}})}catch(e){return console.error("Recommendation API error:",e),e instanceof Error&&e.message,t.status(500).json({error:"Failed to generate recommendations",details:"Internal server error"})}}let l=(0,s.l)(n,"default"),g=(0,s.l)(n,"config"),p=new o.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/recommendations",pathname:"/api/recommendations",bundlePath:"",filename:""},userland:n})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9174],()=>r(3941));module.exports=n})();