"use strict";exports.id=5213,exports.ids=[5213],exports.modules={5213:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(997),i=s(6689),a=s(625),n=s(5658);let o=({userId:e,onAnalysisComplete:t,onInterventionTriggered:s})=>{let o;let[l,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(0),[g,x]=(0,i.useState)(!1),[p,y]=(0,i.useState)(null),[v,b]=(0,i.useState)([]),[N,j]=(0,i.useState)(null),[f,w]=(0,i.useState)([]),[D,S]=(0,i.useState)("en-US"),[k,C]=(0,i.useState)(!0),[M,A]=(0,i.useState)("record"),I=(0,i.useRef)(null),E=(0,i.useRef)([]),T=(0,i.useRef)(null),{trackInteraction:R,trackFeatureUsage:L}=(0,n.VJ)(e);(0,i.useEffect)(()=>(a.V3.on("analysis:completed",U),a.V3.on("intervention:triggered",z),a.V3.on("mood:calculated",$),P(),()=>{a.V3.removeAllListeners(),T.current&&clearInterval(T.current)}),[e]);let P=()=>{j(a.V3.getUserMoodTrends(e)),w(a.V3.getUserInterventions(e))},U=e=>{y(e),x(!1),P(),R("voice-analysis","analysis-completed",{moodScore:e.moodScore?.overall,riskLevel:e.riskAssessment?.riskLevel}),t&&t(e)},z=({intervention:e})=>{w(t=>[e,...t]),R("voice-analysis","intervention-triggered",{severity:e.severity,triggerType:e.triggerType}),s&&s(e)},$=({moodScore:e})=>{L("voice-analysis",60,"completed")},V=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}}),t=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});I.current=t,E.current=[],t.ondataavailable=e=>{e.data.size>0&&E.current.push(e.data)},t.onstop=()=>{let t=new Blob(E.current,{type:"audio/webm"});H(t),e.getTracks().forEach(e=>e.stop())},t.start(100),d(!0),h(0),T.current=setInterval(()=>{h(e=>e+1)},1e3),R("voice-analysis","recording-started",{language:D,privacyMode:k})}catch(e){console.error("Error starting recording:",e),alert("Could not access microphone. Please check permissions.")}},H=async t=>{x(!0);try{let s=new File([t],`voice-note-${Date.now()}.webm`,{type:"audio/webm"}),r={id:await a.V3.uploadVoiceNote(s,e),userId:e,audioUrl:URL.createObjectURL(t),uploadedAt:new Date,duration:u,language:D,isProcessed:!1,isPrivacyProtected:k};b(e=>[r,...e])}catch(e){console.error("Error processing voice note:",e),x(!1),alert("Error processing voice note. Please try again.")}},_=e=>`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`,F=e=>e>=70?"text-green-600":e>=50?"text-yellow-600":e>=30?"text-orange-600":"text-red-600",K=e=>{switch(e){case"low":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"high":return"bg-orange-100 text-orange-800";case"critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"\uD83C\uDF99️ Voice Sentiment Analysis"}),r.jsx("p",{className:"text-gray-600",children:"AI-powered emotional insights from your voice notes"})]})}),r.jsx("div",{className:"bg-white border-b border-gray-200",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4",children:r.jsx("nav",{className:"flex space-x-8",children:[{id:"record",label:"Record",icon:"\uD83C\uDF99️"},{id:"analyze",label:"Analysis",icon:"\uD83D\uDCCA"},{id:"trends",label:"Trends",icon:"\uD83D\uDCC8"},{id:"interventions",label:"Wellness",icon:"\uD83C\uDF1F"}].map(e=>(0,r.jsxs)("button",{onClick:()=>A(e.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors ${M===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[r.jsx("span",{className:"mr-2",children:e.icon}),e.label]},e.id))})})}),(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-6",children:["record"===M&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83C\uDF99️ Voice Note Recording"}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language"}),r.jsx("select",{value:D,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:a.V3.getSupportedLanguages().map(e=>r.jsx("option",{value:e.code,children:e.name},e.code))})]}),r.jsx("div",{className:"mb-6",children:(0,r.jsxs)("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:k,onChange:e=>C(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:l}),r.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Enable privacy protection (on-device processing where possible)"})]})}),r.jsx("div",{className:"text-center mb-6",children:r.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-full text-sm font-medium ${l?c?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:l?(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${c?"bg-yellow-500":"bg-red-500 animate-pulse"}`}),c?"Paused":"Recording"," - ",_(u)]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-400 mr-2"}),"Ready to record"]})})}),r.jsx("div",{className:"flex justify-center space-x-4",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>{I.current&&l&&(c?(I.current.resume(),T.current=setInterval(()=>{h(e=>e+1)},1e3)):(I.current.pause(),T.current&&(clearInterval(T.current),T.current=null)),m(!c))},className:`flex items-center px-6 py-3 rounded-lg transition-colors ${c?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-600 text-white hover:bg-yellow-700"}`,children:[r.jsx("span",{className:"text-xl mr-2",children:c?"▶️":"⏸️"}),c?"Resume":"Pause"]}),(0,r.jsxs)("button",{onClick:()=>{I.current&&l&&(I.current.stop(),d(!1),m(!1),T.current&&(clearInterval(T.current),T.current=null),R("voice-analysis","recording-stopped",{duration:u,language:D}))},className:"flex items-center px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[r.jsx("span",{className:"text-xl mr-2",children:"⏹️"}),"Stop & Analyze"]})]}):(0,r.jsxs)("button",{onClick:V,className:"flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",disabled:g,children:[r.jsx("span",{className:"text-xl mr-2",children:"\uD83C\uDF99️"}),"Start Recording"]})}),g&&r.jsx("div",{className:"mt-6 text-center",children:(0,r.jsxs)("div",{className:"inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-lg",children:[r.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full mr-2"}),"Analyzing voice note..."]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCCB Recent Voice Notes"}),0===v.length?r.jsx("p",{className:"text-gray-500 text-center py-4",children:"No voice notes recorded yet"}):r.jsx("div",{className:"space-y-3",children:v.slice(0,5).map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm font-medium",children:[e.uploadedAt.toLocaleDateString()," at ",e.uploadedAt.toLocaleTimeString()]}),(0,r.jsxs)("p",{className:"text-xs text-gray-600",children:["Duration: ",_(e.duration)," | Language: ",e.language]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isPrivacyProtected&&r.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"\uD83D\uDD12 Protected"}),r.jsx("span",{className:`text-xs px-2 py-1 rounded ${e.isProcessed?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:e.isProcessed?"Analyzed":"Processing"})]})]},e.id))})]})]}),"analyze"===M&&r.jsx("div",{className:"space-y-6",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCCA Mood Analysis"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-3xl font-bold ${F(p.moodScore.overall)}`,children:p.moodScore.overall}),r.jsx("div",{className:"text-lg",children:(o=p.moodScore.overall)>=80?"\uD83D\uDE0A":o>=60?"\uD83D\uDE42":o>=40?"\uD83D\uDE10":o>=20?"\uD83D\uDE14":"\uD83D\uDE22"}),r.jsx("div",{className:"text-sm text-gray-600",children:"Overall Mood"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-2xl font-bold ${F(p.moodScore.emotional)}`,children:p.moodScore.emotional}),r.jsx("div",{className:"text-sm text-gray-600",children:"Emotional"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-2xl font-bold ${F(p.moodScore.stress)}`,children:p.moodScore.stress}),r.jsx("div",{className:"text-sm text-gray-600",children:"Stress Level"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-2xl font-bold ${F(p.moodScore.energy)}`,children:p.moodScore.energy}),r.jsx("div",{className:"text-sm text-gray-600",children:"Energy"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-2xl font-bold ${F(p.moodScore.clarity)}`,children:p.moodScore.clarity}),r.jsx("div",{className:"text-sm text-gray-600",children:"Clarity"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83C\uDFAD Emotion Analysis"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(p.emotions.emotions).map(([e,t])=>(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${100*t}%`}})}),r.jsx("div",{className:"text-sm font-medium capitalize",children:e}),(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:[(100*t).toFixed(1),"%"]})]},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDD0D Key Themes"}),(0,r.jsxs)("div",{className:"space-y-3",children:[p.keywords.concerns.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Concerns"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:p.keywords.concerns.map((e,t)=>r.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs",children:e},t))})]}),p.keywords.supportNeeds.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Support Needs"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:p.keywords.supportNeeds.map((e,t)=>r.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:e},t))})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"⚠️ Risk Assessment"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-medium",children:"Risk Level"}),r.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${K(p.riskAssessment.riskLevel)}`,children:p.riskAssessment.riskLevel.toUpperCase()})]}),p.riskAssessment.recommendations.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Recommendations"}),r.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:p.riskAssessment.recommendations.map((e,t)=>(0,r.jsxs)("li",{className:"flex items-start",children:[r.jsx("span",{className:"text-blue-500 mr-2",children:"•"}),e]},t))})]})]})]})]})]}):(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-md border border-gray-200 text-center",children:[r.jsx("div",{className:"text-6xl mb-4",children:"\uD83C\uDF99️"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Analysis Available"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Record a voice note to see detailed analysis results."}),r.jsx("button",{onClick:()=>A("record"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Record Voice Note"})]})}),"trends"===M&&r.jsx("div",{className:"space-y-6",children:N&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCC8 Mood Trends"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-3xl font-bold ${F(N.averageMood)}`,children:N.averageMood}),r.jsx("div",{className:"text-sm text-gray-600",children:"Average Mood"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-2xl font-bold ${"improving"===N.moodTrend?"text-green-600":"declining"===N.moodTrend?"text-red-600":"concerning"===N.moodTrend?"text-red-600":"text-gray-600"}`,children:"improving"===N.moodTrend?"↗️":"declining"===N.moodTrend?"↘️":"concerning"===N.moodTrend?"⚠️":"➡️"}),r.jsx("div",{className:"text-sm text-gray-600 capitalize",children:N.moodTrend})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:`text-2xl font-bold ${N.volatility<10?"text-green-600":N.volatility<20?"text-yellow-600":"text-red-600"}`,children:N.volatility}),r.jsx("div",{className:"text-sm text-gray-600",children:"Volatility"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${K(N.riskLevel)}`,children:N.riskLevel.toUpperCase()}),r.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Risk Level"})]})]})]}),N.recommendations.length>0&&(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-md border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCA1 Personalized Recommendations"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.recommendations.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start p-3 bg-blue-50 rounded-lg",children:[r.jsx("span",{className:"text-blue-500 text-xl mr-3",children:"\uD83D\uDCA1"}),r.jsx("p",{className:"text-sm text-blue-800",children:e})]},t))})]})]})}),"interventions"===M&&r.jsx("div",{className:"space-y-6",children:0===f.length?(0,r.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-md border border-gray-200 text-center",children:[r.jsx("div",{className:"text-6xl mb-4",children:"\uD83C\uDF1F"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Interventions Needed"}),r.jsx("p",{className:"text-gray-600",children:"Great! No concerning patterns detected in your voice notes."})]}):r.jsx("div",{className:"space-y-4",children:f.map(e=>(0,r.jsxs)("div",{className:`bg-white rounded-lg p-6 shadow-md border-l-4 ${"critical"===e.severity?"border-red-500":"high"===e.severity?"border-orange-500":"medium"===e.severity?"border-yellow-500":"border-blue-500"}`,children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Wellness Check-in"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.timestamp.toLocaleDateString()," at ",e.timestamp.toLocaleTimeString()]})]}),r.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"critical"===e.severity?"bg-red-100 text-red-800":"high"===e.severity?"bg-orange-100 text-orange-800":"medium"===e.severity?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:e.severity.toUpperCase()})]}),r.jsx("p",{className:"text-gray-800 mb-4",children:e.message}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Suggested Actions:"}),e.actions.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-medium",children:e.title}),r.jsx("p",{className:"text-sm text-gray-600",children:e.description})]}),e.url&&r.jsx("a",{href:e.url,className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:"Access"})]},t))]})]},e.id))})})]})]})}},625:(e,t,s)=>{s.d(t,{V3:()=>a});var r=s(7702);class i extends r.EventEmitter{constructor(e,t=!0){super(),this.azureConfig=e,this.privacyMode=t,this.voiceNotes=new Map,this.analysisResults=new Map,this.userMoodHistory=new Map,this.interventions=new Map,this.supportedLanguages=new Map,this.initializeLanguageSupport(),this.setupAzureServices()}initializeLanguageSupport(){[{code:"en-US",name:"English (US)",supported:!0,mentalHealthVocabulary:["depressed","anxious","stressed","overwhelmed","hopeless","suicidal","panic","worried","sad","angry","frustrated","tired","exhausted","happy","grateful","calm","peaceful","confident","motivated"],culturalContext:{expressionPatterns:["I feel like","I am struggling with","I need help"],stigmaTerms:["crazy","mental","insane"],supportTerms:["therapy","counseling","support group","medication"]}},{code:"zh-CN",name:"Chinese (Simplified)",supported:!0,mentalHealthVocabulary:["抑郁","焦虑","压力","绝望","痛苦","困扰","开心","感激","平静","自信","动力"],culturalContext:{expressionPatterns:["我觉得","我很担心","我需要帮助"],stigmaTerms:["疯子","神经病"],supportTerms:["心理治疗","咨询","支持小组"]}},{code:"es-ES",name:"Spanish",supported:!0,mentalHealthVocabulary:["deprimido","ansioso","estresado","abrumado","desesperanzado","feliz","agradecido","tranquilo","confiado","motivado"],culturalContext:{expressionPatterns:["Me siento","Estoy luchando con","Necesito ayuda"],stigmaTerms:["loco","mental"],supportTerms:["terapia","consejer\xeda","grupo de apoyo"]}}].forEach(e=>{this.supportedLanguages.set(e.code,e)})}async setupAzureServices(){try{this.emit("services:initialized",{speech:!0,textAnalytics:!0,language:!0,timestamp:new Date})}catch(e){this.emit("services:error",{error:e,timestamp:new Date})}}async analyzeVoiceNote(e){try{this.emit("analysis:started",{noteId:e.id,userId:e.userId});let t=await this.speechToText(e),s=await this.detectLanguage(t.text),r=await this.analyzeEmotions(t,s),i=await this.extractMentalHealthKeywords(t.text,s),a=this.calculateMoodScore(r,i,t);this.updateUserMoodHistory(e.userId,a);let n=await this.assessRisk(e.userId,a,i);n.interventionNeeded&&await this.triggerIntervention(e.userId,n);let o={noteId:e.id,userId:e.userId,speechResult:t,language:s,emotions:r,keywords:i,moodScore:a,riskAssessment:n,timestamp:new Date,privacyProtected:this.privacyMode};return this.analysisResults.set(e.id,o),this.emit("analysis:completed",o),o}catch(t){throw this.emit("analysis:error",{error:t,noteId:e.id}),t}}async speechToText(e){let t={text:"I've been feeling really overwhelmed lately. Work stress is getting to me and I'm having trouble sleeping. I think I need some help but I'm not sure where to start.",confidence:.92,language:"en-US",duration:e.duration,segments:[{text:"I've been feeling really overwhelmed lately.",startTime:0,endTime:3.2,confidence:.95},{text:"Work stress is getting to me and I'm having trouble sleeping.",startTime:3.5,endTime:7.8,confidence:.88},{text:"I think I need some help but I'm not sure where to start.",startTime:8.1,endTime:12.3,confidence:.94}]};return await new Promise(e=>setTimeout(e,2e3)),this.emit("speech:converted",{noteId:e.id,confidence:t.confidence}),t}async detectLanguage(e){return e.includes("我")||e.includes("很")?"zh-CN":e.includes("siento")||e.includes("ayuda")?"es-ES":"en-US"}async analyzeEmotions(e,t){let s={primaryEmotion:"anxiety",emotions:{joy:.1,sadness:.3,anger:.15,fear:.25,surprise:.05,disgust:.05,neutral:.1,anxiety:.7,stress:.8},arousal:.7,valence:.3,confidence:.85};return this.emit("emotions:analyzed",{emotions:s,language:t}),s}async extractMentalHealthKeywords(e,t){if(!this.supportedLanguages.get(t))throw Error(`Language ${t} not supported`);let s={concerns:["overwhelmed","stress","trouble sleeping"],positiveIndicators:[],riskKeywords:[],copingMechanisms:[],supportNeeds:["help"],categories:{depression:.3,anxiety:.7,stress:.8,suicidalIdeation:0,selfHarm:0,substance:0,relationships:.1,work:.6,sleep:.5,eating:0}};return this.emit("keywords:extracted",{keywords:s,language:t}),s}calculateMoodScore(e,t,s){let r=(100*e.emotions.joy+(1-e.emotions.sadness)*100+(1-e.emotions.anxiety)*100)/3,i=(1-e.emotions.stress)*100,a=100*e.arousal,n=100*s.confidence,o=Math.max(0,100-Object.values(t.categories).reduce((e,t)=>e+t,0)/10*100),l={overall:Math.round(.3*r+.25*i+.2*a+.15*n+.1*o),emotional:Math.round(r),stress:Math.round(i),energy:Math.round(a),clarity:Math.round(n),timestamp:new Date,confidence:e.confidence,factors:{tone:Math.round(100*e.valence),pace:Math.round(s.duration>0?s.text.length/s.duration*10:50),volume:Math.round(100*e.arousal),keywords:Math.round(o),sentiment:Math.round(100*e.valence)}};return this.emit("mood:calculated",{moodScore:l}),l}updateUserMoodHistory(e,t){this.userMoodHistory.has(e)||this.userMoodHistory.set(e,[]);let s=this.userMoodHistory.get(e);s.push(t),s.length>100&&s.shift(),this.emit("mood:updated",{userId:e,historyLength:s.length})}async assessRisk(e,t,s){let r=this.userMoodHistory.get(e)||[],i=t.overall<30,a=t.stress<40,n=s.categories.suicidalIdeation>.3||s.categories.selfHarm>.3,o=this.calculateTrendDecline(r),l="low",d=!1;return n||s.categories.suicidalIdeation>.5?(l="critical",d=!0):i&&a&&o?(l="high",d=!0):(i||a)&&(l="medium",d=t.overall<25),{riskLevel:l,interventionNeeded:d,factors:{lowMoodScore:i,highStress:a,riskKeywords:n,trendDecline:o},recommendations:this.generateRecommendations(l,s)}}calculateTrendDecline(e){if(e.length<5)return!1;let t=e.slice(-5),s=e.slice(-10,-5);return 0!==s.length&&t.reduce((e,t)=>e+t.overall,0)/t.length<s.reduce((e,t)=>e+t.overall,0)/s.length-15}generateRecommendations(e,t){let s=[];return"critical"===e?(s.push("Immediate professional help recommended"),s.push("Contact crisis hotline"),s.push("Reach out to trusted friend or family member")):"high"===e?(s.push("Consider speaking with a mental health professional"),s.push("Try stress reduction techniques"),s.push("Ensure adequate sleep and nutrition")):"medium"===e&&(s.push("Practice mindfulness or meditation"),s.push("Engage in physical activity"),s.push("Connect with support network")),t.categories.work>.5&&s.push("Consider work-life balance strategies"),t.categories.sleep>.5&&s.push("Focus on sleep hygiene"),t.categories.anxiety>.5&&s.push("Try anxiety management techniques"),s}async triggerIntervention(e,t){let s={id:`intervention-${Date.now()}`,userId:e,triggerType:"mood_decline",severity:t.riskLevel,message:this.generateInterventionMessage(t),actions:this.generateInterventionActions(t),timestamp:new Date,responded:!1};this.interventions.has(e)||this.interventions.set(e,[]),this.interventions.get(e).push(s),this.emit("intervention:triggered",{intervention:s}),"critical"===t.riskLevel&&await this.executeCriticalIntervention(s)}generateInterventionMessage(e){let t={critical:"We've noticed some concerning patterns in your recent voice notes. Your wellbeing is important to us. Please consider reaching out for immediate support.",high:"It seems like you might be going through a difficult time. Remember that support is available and you don't have to face this alone.",medium:"We've noticed you might be experiencing some stress. Here are some resources that might help.",low:"Keep taking care of yourself. Here are some wellness tips for you."};return t[e.riskLevel]||t.medium}generateInterventionActions(e){let t=[];return"critical"===e.riskLevel&&t.push({type:"emergency_protocol",title:"Crisis Support",description:"Connect with crisis counselor immediately",url:"tel:988",priority:1,automated:!0}),("high"===e.riskLevel||"critical"===e.riskLevel)&&t.push({type:"professional_contact",title:"Professional Help",description:"Schedule appointment with mental health professional",priority:2,automated:!1}),t.push({type:"resource_suggestion",title:"Coping Resources",description:"Access curated mental health resources",url:"/resources",priority:3,automated:!0}),t.push({type:"peer_connect",title:"Peer Support",description:"Connect with peer support community",url:"/peer-support",priority:4,automated:!0}),t}async executeCriticalIntervention(e){this.emit("intervention:critical",{intervention:e,timestamp:new Date,autoExecuted:!0})}async uploadVoiceNote(e,t){let s={id:`voice-${Date.now()}-${t}`,userId:t,audioUrl:URL.createObjectURL(e),uploadedAt:new Date,duration:0,isProcessed:!1,isPrivacyProtected:this.privacyMode};return this.voiceNotes.set(s.id,s),this.analyzeVoiceNote(s).catch(e=>{this.emit("upload:error",{error:e,noteId:s.id})}),s.id}getUserMoodTrends(e,t="weekly"){let s=this.userMoodHistory.get(e)||[];if(0===s.length)return{timeframe:t,moodTrend:"stable",averageMood:50,volatility:0,riskLevel:"low",recommendations:["Continue regular check-ins"],interventionNeeded:!1};let r=s.slice(-7),i=r.reduce((e,t)=>e+t.overall,0)/r.length,a=Math.sqrt(r.reduce((e,t)=>e+Math.pow(t.overall-i,2),0)/r.length),n="stable";if(r.length>=3){let e=r.slice(0,Math.floor(r.length/2)),t=r.slice(Math.floor(r.length/2)),s=e.reduce((e,t)=>e+t.overall,0)/e.length,i=t.reduce((e,t)=>e+t.overall,0)/t.length;i>s+10?n="improving":i<s-10?n="declining":i<30&&(n="concerning")}let o="low";return i<25||"concerning"===n?o="critical":i<40||"declining"===n?o="high":(i<60||a>20)&&(o="medium"),{timeframe:t,moodTrend:n,averageMood:Math.round(i),volatility:Math.round(a),riskLevel:o,recommendations:this.generateRecommendations(o,{categories:{}}),interventionNeeded:"critical"===o||"high"===o}}getAnalysisResult(e){return this.analysisResults.get(e)}getUserInterventions(e){return this.interventions.get(e)||[]}getSupportedLanguages(){return Array.from(this.supportedLanguages.values())}enablePrivacyMode(e){this.privacyMode=e,this.emit("privacy:updated",{enabled:e})}deleteUserData(e){this.userMoodHistory.delete(e),this.interventions.delete(e),Array.from(this.voiceNotes.entries()).filter(([t,s])=>s.userId===e).forEach(([e,t])=>{this.voiceNotes.delete(e),this.analysisResults.delete(e)}),this.emit("data:deleted",{userId:e})}}let a=new i({speechKey:process.env.AZURE_SPEECH_KEY||"demo-key",speechRegion:process.env.AZURE_SPEECH_REGION||"eastus",textAnalyticsKey:process.env.AZURE_TEXT_ANALYTICS_KEY||"demo-key",textAnalyticsEndpoint:process.env.AZURE_TEXT_ANALYTICS_ENDPOINT||"https://demo.cognitiveservices.azure.com/",languageKey:process.env.AZURE_LANGUAGE_KEY||"demo-key",languageEndpoint:process.env.AZURE_LANGUAGE_ENDPOINT||"https://demo.cognitiveservices.azure.com/"})}};