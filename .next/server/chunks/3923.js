"use strict";exports.id=3923,exports.ids=[3923],exports.modules={3923:(e,t,s)=>{s.d(t,{b:()=>o});var i=s(7702),r=s(1121),a=s.n(r);class n extends i.EventEmitter{constructor(){super(),this.users=new Map,this.transactions=new Map,this.streaks=new Map,this.rewards=new Map,this.qrRedemptions=new Map,this.achievements=new Map,this.levels=[],this.initializeLevels(),this.initializeRewards(),this.startPeriodicTasks()}createUser(e){let t={userId:e.userId,username:e.username,email:e.email,joinedAt:new Date,lastActive:new Date,currentLevel:1,totalPoints:0,availablePoints:0,lifetimePoints:0,currentStreak:0,longestStreak:0,achievements:[],badges:[],preferences:{shareProgress:!0,notifications:!0,leaderboard:!0}};return this.users.set(e.userId,t),this.transactions.set(e.userId,[]),this.streaks.set(e.userId,[]),this.awardPoints(e.userId,"achievement",50,"Welcome to SATA! \uD83C\uDF89","welcome-bonus"),this.emit("userCreated",t),t}getUser(e){return this.users.get(e)}getTransactions(e){return this.transactions.get(e)||[]}updateLastActivity(e){let t=this.users.get(e);t&&(t.lastActive=new Date,this.users.set(e,t))}awardPoints(e,t,s,i,r,a){let n=this.users.get(e);if(!n)return null;let o={id:`txn_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,userId:e,type:"earn",category:t,amount:s,description:i,metadata:a,timestamp:new Date,source:r};n.totalPoints+=s,n.availablePoints+=s,n.lifetimePoints+=s,n.lastActive=new Date;let l=this.calculateLevel(n.totalPoints);if(l>n.currentLevel){let e=(l-n.currentLevel)*25;n.currentLevel=l,n.availablePoints+=e,this.emit("levelUp",{user:n,newLevel:l,bonus:e,levelInfo:this.levels[l-1]})}let c=this.transactions.get(e)||[];return c.unshift(o),this.transactions.set(e,c),this.users.set(e,n),this.checkAchievements(e,t,s,a),this.emit("pointsAwarded",o),o}spendPoints(e,t,s,i){let r=this.users.get(e);if(!r||r.availablePoints<t)return!1;let a={id:`txn_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,userId:e,type:"spend",category:"redemption",amount:-t,description:s,timestamp:new Date,source:i};r.availablePoints-=t,r.lastActive=new Date;let n=this.transactions.get(e)||[];return n.unshift(a),this.transactions.set(e,n),this.users.set(e,r),this.emit("pointsSpent",a),!0}recordDailyCheckIn(e,t,s){let i=0;t>=7&&(i+=5),t>=9&&(i+=5);let r=this.updateStreak(e,"daily-check-in");r&&r.current>0&&(i+=Math.min(r.current,20));let a=10+i,n=`Daily check-in completed (Mood: ${t}/10)${i>0?` +${i} bonus`:""}`;return this.awardPoints(e,"check-in",a,n,"daily-check-in",{mood:t,notes:s,streak:r?.current||0,bonus:i})}recordAssessment(e,t,s){let i=0;switch(t){case"PHQ-4":i=25;break;case"mood-tracker":default:i=15;break;case"wellness-survey":i=20}let r=this.updateStreak(e,"assessment");r&&r.current>1&&(i+=Math.min(2*r.current,15));let a=`${t} assessment completed`;return this.awardPoints(e,"assessment",i,a,"assessment-system",{assessmentType:t,score:s,streak:r?.current||0})}recordEducationalEngagement(e,t,s){let i=0;switch(t){case"article":i=Math.min(2*Math.floor(s/60),10);break;case"video":i=Math.min(3*Math.floor(s/60),15);break;case"interactive":i=Math.min(4*Math.floor(s/60),20);break;case"quiz":i=15;break;default:i=Math.min(2*Math.floor(s/60),8)}let r=`Engaged with ${t} (${Math.floor(s/60)}min)`;return this.awardPoints(e,"education",i,r,"education-system",{contentType:t,duration:s})}recordPeerSupportActivity(e,t,s){let i=0;switch(t){case"group-message":default:i=5;break;case"group-voice":i=10;break;case"support-given":i=15;break;case"group-check-in":i=12}s&&s>=4&&(i+=5);let r=`Peer support: ${t.replace("-"," ")}`;return this.awardPoints(e,"peer-support",i,r,"peer-support-system",{activityType:t,quality:s})}recordBuddyInteraction(e,t,s,i){let r=0;switch(t){case"text-chat":r=5;break;case"voice-call":r=15+Math.min(Math.floor((i||0)/300),10);break;case"check-in":r=20;break;case"goal-update":r=18;break;default:r=8}r=Math.round(s/3*r);let a=`Buddy ${t.replace("-"," ")} (${s}â­)`;return this.awardPoints(e,"buddy",r,a,"buddy-system",{interactionType:t,quality:s,duration:i})}recordResourceUtilization(e,t,s){let i=0;switch(s){case"view":i=2;break;case"save":i=5;break;case"share":i=8;break;case"review":i=12;break;case"contact":i=15;break;default:i=3}let r=`Resource ${s}: ${t}`;return this.awardPoints(e,"resource",i,r,"resource-system",{resourceType:t,engagement:s})}updateStreak(e,t){let s=this.streaks.get(e)||[],i=s.find(e=>e.type===t);i||(i={userId:e,type:t,current:0,longest:0,lastActivity:new Date,isActive:!0},s.push(i));let r=new Date,a=new Date(i.lastActivity),n=Math.floor((r.getTime()-a.getTime())/864e5);if(0===n)return i;if(1===n?i.current++:i.current=1,i.isActive=!0,i.current>i.longest&&(i.longest=i.current),i.lastActivity=r,this.streaks.set(e,s),i.current>1){let s=this.calculateStreakBonus(i.current,t);s>0&&this.awardPoints(e,"streak",s,`${i.current}-day ${t} streak bonus! ðŸ”¥`,"streak-system",{streakType:t,streakLength:i.current})}let o=this.users.get(e);return o&&"daily-check-in"===t&&(o.currentStreak=i.current,i.longest>o.longestStreak&&(o.longestStreak=i.longest),this.users.set(e,o)),this.emit("streakUpdated",i),i}calculateStreakBonus(e,t){let s={"daily-check-in":2,assessment:3,learning:2,"peer-support":3,overall:4}[t]||2;return 7===e?5*s:30===e?15*s:100===e?50*s:365===e?200*s:e>=30?3*s:e>=14?2*s:e>=7?s:e>=3?Math.floor(s/2):0}checkAchievements(e,t,s,i){let r=this.users.get(e);if(!r)return;let a=this.transactions.get(e)||[],n=this.streaks.get(e)||[];this.checkPointMilestones(r,a),this.checkStreakAchievements(r,n),this.checkCategorySpecificAchievements(r,t,a,i),this.checkConsistencyAchievements(r,a),this.checkSocialAchievements(r,a)}checkPointMilestones(e,t){[{points:100,id:"first-hundred",name:"Century Club",description:"Earned your first 100 points!"},{points:500,id:"five-hundred",name:"Rising Star",description:"500 points earned - you're on fire!"},{points:1e3,id:"thousand",name:"Point Master",description:"1,000 points! You're dedicated to wellness."},{points:2500,id:"twenty-five-hundred",name:"Wellness Warrior",description:"2,500 points - a true wellness champion!"},{points:5e3,id:"five-thousand",name:"Legendary Status",description:"5,000 points! Legendary dedication."}].forEach(t=>{e.lifetimePoints>=t.points&&!e.achievements.find(e=>e.id===t.id)&&this.awardAchievement(e.userId,t.id,t.name,t.description,"milestone",50)})}checkStreakAchievements(e,t){let s=t.find(e=>"daily-check-in"===e.type);s&&[{streak:3,id:"three-day-streak",name:"Getting Started",description:"3-day check-in streak!"},{streak:7,id:"week-warrior",name:"Week Warrior",description:"7-day check-in streak! \uD83D\uDD25"},{streak:30,id:"month-master",name:"Monthly Master",description:"30-day streak - incredible consistency!"},{streak:100,id:"hundred-day-hero",name:"Hundred Day Hero",description:"100 days strong! Unstoppable!"},{streak:365,id:"year-champion",name:"Year Champion",description:"A full year of daily check-ins! \uD83C\uDFC6"}].forEach(t=>{s.longest>=t.streak&&!e.achievements.find(e=>e.id===t.id)&&this.awardAchievement(e.userId,t.id,t.name,t.description,"consistency",t.streak>=100?100:t.streak>=30?75:50)})}awardAchievement(e,t,s,i,r,a){let n=this.users.get(e);if(!n)return;let o={id:t,name:s,description:i,icon:this.getAchievementIcon(r),category:r,points:a,rarity:this.getAchievementRarity(a),unlockedAt:new Date};n.achievements.push(o),this.users.set(e,n),this.awardPoints(e,"achievement",a,`Achievement unlocked: ${s}`,"achievement-system",{achievementId:t}),this.emit("achievementUnlocked",{user:n,achievement:o})}getAchievementIcon(e){return({wellness:"\uD83C\uDF31",social:"\uD83E\uDD1D",learning:"\uD83D\uDCDA",consistency:"\uD83D\uDD25",milestone:"\uD83C\uDFC6"})[e]||"â­"}getAchievementRarity(e){return e>=100?"legendary":e>=75?"epic":e>=50?"rare":"common"}initializeLevels(){this.levels=[{level:1,name:"Newcomer",pointsRequired:0,badge:"\uD83C\uDF31",perks:["Daily check-ins","Basic resources"],color:"#10B981"},{level:2,name:"Explorer",pointsRequired:100,badge:"\uD83D\uDD0D",perks:["Assessment tools","Educational content"],color:"#3B82F6"},{level:3,name:"Supporter",pointsRequired:300,badge:"\uD83E\uDD1D",perks:["Peer support groups","Buddy matching"],color:"#8B5CF6"},{level:4,name:"Advocate",pointsRequired:600,badge:"\uD83D\uDCAA",perks:["Advanced resources","Priority support"],color:"#F59E0B"},{level:5,name:"Champion",pointsRequired:1e3,badge:"\uD83C\uDFC6",perks:["Leadership roles","Exclusive rewards"],color:"#EF4444"},{level:6,name:"Mentor",pointsRequired:1500,badge:"\uD83D\uDC68â€\uD83C\uDFEB",perks:["Mentorship opportunities","Special recognition"],color:"#EC4899"},{level:7,name:"Guardian",pointsRequired:2500,badge:"\uD83D\uDEE1ï¸",perks:["Community moderation","Expert status"],color:"#6366F1"},{level:8,name:"Sage",pointsRequired:4e3,badge:"\uD83E\uDDD9â€â™‚ï¸",perks:["Wisdom sharing","Platform influence"],color:"#8B5CF6"},{level:9,name:"Legend",pointsRequired:6e3,badge:"â­",perks:["Legendary status","All perks unlocked"],color:"#F59E0B"},{level:10,name:"Enlightened",pointsRequired:1e4,badge:"âœ¨",perks:["Enlightened one","Ultimate recognition"],color:"#10B981"}]}calculateLevel(e){for(let t=this.levels.length-1;t>=0;t--)if(e>=this.levels[t].pointsRequired)return this.levels[t].level;return 1}getLevelInfo(e){return this.levels.find(t=>t.level===e)}initializeRewards(){[{id:"wellness-tea",name:"Wellness Tea Package",description:"Calming herbal tea blend for relaxation",category:"wellness",pointCost:200,icon:"\uD83C\uDF75",availability:"unlimited",isActive:!0},{id:"meditation-app",name:"Premium Meditation App (1 Month)",description:"Access to premium meditation content",category:"digital",pointCost:500,icon:"\uD83E\uDDD8â€â™€ï¸",availability:"unlimited",isActive:!0},{id:"wellness-journal",name:"Wellness Journal",description:"Beautiful journal for mindfulness practice",category:"physical",pointCost:300,icon:"\uD83D\uDCD4",availability:"limited",stock:50,isActive:!0},{id:"counseling-session",name:"Free Counseling Session",description:"One-on-one session with certified counselor",category:"wellness",pointCost:1e3,icon:"\uD83D\uDC68â€âš•ï¸",availability:"limited",stock:10,isActive:!0,requirements:{minLevel:3}},{id:"fitness-tracker",name:"Fitness & Wellness Tracker",description:"Smart device to monitor health metrics",category:"physical",pointCost:2e3,icon:"âŒš",availability:"limited",stock:5,isActive:!0,requirements:{minLevel:5}}].forEach(e=>{this.rewards.set(e.id,e)})}getAvailableRewards(e){let t=this.users.get(e);return t?Array.from(this.rewards.values()).filter(e=>!!e.isActive&&(!e.requirements||!e.requirements.minLevel||!(t.currentLevel<e.requirements.minLevel))&&("limited"!==e.availability||void 0===e.stock||!(e.stock<=0))):[]}async redeemReward(e,t){let s=this.users.get(e),i=this.rewards.get(t);if(!s||!i||!i.isActive||s.availablePoints<i.pointCost||i.requirements&&i.requirements.minLevel&&s.currentLevel<i.requirements.minLevel||"limited"===i.availability&&void 0!==i.stock&&i.stock<=0||!this.spendPoints(e,i.pointCost,`Redeemed: ${i.name}`,"reward-system"))return null;"limited"===i.availability&&void 0!==i.stock&&(i.stock--,this.rewards.set(t,i));let r=`redemption_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,n={redemptionId:r,userId:e,rewardId:t,timestamp:Date.now()},o={id:r,userId:e,rewardId:t,qrCode:await a().toDataURL(JSON.stringify(n)),generatedAt:new Date,expiresAt:new Date(Date.now()+2592e6),isRedeemed:!1};return this.qrRedemptions.set(r,o),this.emit("rewardRedeemed",{user:s,reward:i,redemption:o}),o}async validateQRRedemption(e){try{let t=JSON.parse(e),s=this.qrRedemptions.get(t.redemptionId);if(!s)return{valid:!1,message:"Invalid redemption code"};if(s.isRedeemed)return{valid:!1,message:"This reward has already been redeemed"};if(new Date>s.expiresAt)return{valid:!1,message:"This redemption code has expired"};return{valid:!0,redemption:s,message:"Valid redemption code"}}catch(e){return{valid:!1,message:"Invalid QR code format"}}}completeQRRedemption(e,t){let s=this.qrRedemptions.get(e);return!!s&&!s.isRedeemed&&(s.isRedeemed=!0,s.redeemedAt=new Date,s.redemptionLocation=t,this.qrRedemptions.set(e,s),this.emit("redemptionCompleted",s),!0)}getLeaderboard(e="all-time",t=10){let s=Array.from(this.users.values()).filter(e=>e.preferences.leaderboard).map(e=>({userId:e.userId,username:e.username,points:e.totalPoints,level:e.currentLevel,rank:0,badge:this.getLevelInfo(e.currentLevel)?.badge||""})).sort((e,t)=>t.points-e.points).slice(0,t);return s.forEach((e,t)=>{e.rank=t+1}),s}getUserStats(e){let t=this.users.get(e),s=this.transactions.get(e)||[],i=this.streaks.get(e)||[];if(!t)return null;let r=s.reduce((e,t)=>("earn"===t.type&&(e[t.category]=(e[t.category]||0)+t.amount),e),{});return{user:t,totalTransactions:s.length,categoryBreakdown:r,achievements:t.achievements.length,currentStreaks:i.filter(e=>e.isActive),longestStreaks:i.map(e=>({type:e.type,length:e.longest})),level:this.getLevelInfo(t.currentLevel),nextLevel:this.getLevelInfo(t.currentLevel+1),pointsToNextLevel:this.getLevelInfo(t.currentLevel+1)?.pointsRequired?this.getLevelInfo(t.currentLevel+1).pointsRequired-t.totalPoints:0}}getAllUsers(){return Array.from(this.users.values())}getSystemStats(){let e=Array.from(this.users.values()),t=Array.from(this.transactions.values()).flat();return{totalUsers:e.length,activeUsers:e.filter(e=>(Date.now()-e.lastActive.getTime())/864e5<=7).length,totalPointsAwarded:t.filter(e=>"earn"===e.type).reduce((e,t)=>e+t.amount,0),totalPointsSpent:t.filter(e=>"spend"===e.type).reduce((e,t)=>e+Math.abs(t.amount),0),averageLevel:e.length>0?e.reduce((e,t)=>e+t.currentLevel,0)/e.length:0,totalAchievements:e.reduce((e,t)=>e+t.achievements.length,0),rewardsRedeemed:Array.from(this.qrRedemptions.values()).filter(e=>e.isRedeemed).length}}startPeriodicTasks(){setInterval(()=>{this.checkInactiveStreaks()},864e5),setInterval(()=>{this.cleanupExpiredRedemptions()},6048e5)}checkInactiveStreaks(){let e=new Date;for(let[t,s]of this.streaks)s.forEach(s=>{Math.floor((e.getTime()-s.lastActivity.getTime())/864e5)>1&&s.isActive&&(s.current=0,s.isActive=!1,this.emit("streakBroken",{userId:t,streak:s}))}),this.streaks.set(t,s)}cleanupExpiredRedemptions(){let e=new Date;for(let[t,s]of this.qrRedemptions)e>s.expiresAt&&!s.isRedeemed&&this.qrRedemptions.delete(t)}checkCategorySpecificAchievements(e,t,s,i){let r=s.filter(e=>e.category===t&&"earn"===e.type);switch(t){case"check-in":1===r.length&&this.awardAchievement(e.userId,"first-check-in","First Steps","Completed your first daily check-in!","wellness",25),30===r.length&&this.awardAchievement(e.userId,"check-in-master","Check-in Master","30 daily check-ins completed!","wellness",75);break;case"assessment":1===r.length&&this.awardAchievement(e.userId,"first-assessment","Self-Awareness","Completed your first assessment!","wellness",25),10===r.length&&this.awardAchievement(e.userId,"assessment-expert","Assessment Expert","10 assessments completed!","wellness",50);break;case"education":r.reduce((e,t)=>e+t.amount,0)>=100&&this.awardAchievement(e.userId,"knowledge-seeker","Knowledge Seeker","Earned 100+ education points!","learning",50);break;case"peer-support":5===r.length&&this.awardAchievement(e.userId,"helpful-peer","Helpful Peer","Actively participated in peer support!","social",40);break;case"buddy":10===r.length&&this.awardAchievement(e.userId,"great-buddy","Great Buddy","Excellent buddy interactions!","social",60)}}checkConsistencyAchievements(e,t){7===new Set(t.filter(e=>(Date.now()-e.timestamp.getTime())/864e5<=7&&"earn"===e.type).map(e=>e.timestamp.toDateString())).size&&this.awardAchievement(e.userId,"week-consistency","Consistency Champion","7 days of consistent activity!","consistency",75)}checkSocialAchievements(e,t){t.filter(e=>("peer-support"===e.category||"buddy"===e.category)&&"earn"===e.type).length>=25&&this.awardAchievement(e.userId,"social-butterfly","Social Butterfly","Active in social features!","social",60)}}let o=new n}};