"use strict";exports.id=9093,exports.ids=[9093],exports.modules={9093:(e,t,r)=>{r.d(t,{Z:()=>s});class a{constructor(){this.resources=[],this.userProfiles=new Map,this.interactions=[],this.abTests=new Map,this.metrics=[],this.modelWeights={phq4ScoreWeight:.25,demographicWeight:.2,culturalWeight:.15,collaborativeWeight:.2,usagePatternWeight:.1,recencyWeight:.1},this.initializeResources(),this.initializeABTests()}async getRecommendations(e){let{userProfile:t,context:r,abTestGroup:a}=e,s=this.getRecommendationStrategy(t,a),i=[];switch(s){case"content-based":i=await this.getContentBasedRecommendations(t,r);break;case"collaborative":i=await this.getCollaborativeRecommendations(t,r);break;case"demographic":i=await this.getDemographicRecommendations(t,r);break;case"ml-predicted":i=await this.getMLPredictedRecommendations(t,r);break;default:i=await this.getHybridRecommendations(t,r)}return i=(i=this.applyContextFilters(i,r)).sort((e,t)=>t.score-e.score).slice(0,r.maxRecommendations),i=this.addPersonalizedMessages(i,t),this.logRecommendationMetrics(i,t,s,a),i}async getContentBasedRecommendations(e,t){let r=[],a=e.phq4Scores.latest;for(let t of this.resources){let s=0,i=[];t.metadata.riskLevels.includes(a.riskLevel)&&(s+=.3,i.push(`Suitable for ${a.riskLevel} risk level`)),t.metadata.languages.includes(e.demographics.language)&&(s+=.2,i.push(`Available in ${e.demographics.language}`));let o=e.demographics.countryOfOrigin;o&&t.metadata.culturalContext.includes(o)&&(s+=.15,i.push(`Culturally appropriate for ${o}`));let n=t.metadata.targetDemographics;n.ageGroups?.includes(e.demographics.ageGroup||"")&&(s+=.1,i.push("Age-appropriate content")),n.employmentSectors?.includes(e.demographics.employmentSector||"")&&(s+=.1,i.push("Relevant to your work situation"));let c=e.demographics.location?.country;c&&t.availability.locations.includes(c)&&(s+=.15,i.push("Available in your location")),s>.3&&r.push({resource:t,score:s,reasons:i,strategy:"content-based",urgency:this.calculateUrgency(a.riskLevel,t.type),estimatedHelpfulness:this.estimateHelpfulness(t,e)})}return r}async getCollaborativeRecommendations(e,t){let r=[],a=this.findSimilarUsers(e),s=new Map;for(let e of a){let t=e.similarity;for(let r of e.profile.interactionHistory)if("rate"===r.type&&r.rating&&r.rating>=4){let e=s.get(r.resourceId)||{score:0,count:0,reasons:new Set};e.score+=r.rating/5*t,e.count+=1,e.reasons.add("Highly rated by users with similar background"),s.set(r.resourceId,e)}}for(let[t,a]of s.entries()){let s=this.resources.find(e=>e.id===t);if(s&&a.count>=3){let t=a.score/a.count;r.push({resource:s,score:t,reasons:Array.from(a.reasons),strategy:"collaborative",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,s.type),estimatedHelpfulness:t})}}return r}async getDemographicRecommendations(e,t){let r=[],a=e.demographics;for(let t of this.resources){let s=0,i=[];a.countryOfOrigin&&t.metadata.targetDemographics.countries?.includes(a.countryOfOrigin)&&(s+=.3,i.push(`Designed for ${a.countryOfOrigin} nationals`)),a.employmentSector&&t.metadata.targetDemographics.employmentSectors?.includes(a.employmentSector)&&(s+=.25,i.push(`Tailored for ${a.employmentSector} workers`)),a.ageGroup&&t.metadata.targetDemographics.ageGroups?.includes(a.ageGroup)&&(s+=.2,i.push("Appropriate for your age group")),a.gender&&t.metadata.targetDemographics.genders?.includes(a.gender)&&(s+=.15,i.push("Gender-specific content")),t.metadata.languages.includes(a.language)&&(s+=.1,i.push(`Available in ${a.language}`)),s>.4&&r.push({resource:t,score:s,reasons:i,strategy:"demographic",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,t.type),estimatedHelpfulness:this.estimateHelpfulness(t,e)})}return r}async getMLPredictedRecommendations(e,t){let r=[],a=this.extractUserFeatures(e);for(let t of this.resources){let s=this.extractResourceFeatures(t),i=this.predictResourceFit(a,s);i.score>.5&&r.push({resource:t,score:i.score,reasons:i.reasons,strategy:"ml-predicted",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,t.type),estimatedHelpfulness:i.score})}return r}async getHybridRecommendations(e,t){let r=await this.getContentBasedRecommendations(e,t),a=await this.getCollaborativeRecommendations(e,t),s=await this.getDemographicRecommendations(e,t),i=await this.getMLPredictedRecommendations(e,t),o=new Map;for(let e of[...r.map(e=>({...e,strategy:"content-based"})),...a.map(e=>({...e,strategy:"collaborative"})),...s.map(e=>({...e,strategy:"demographic"})),...i.map(e=>({...e,strategy:"ml-predicted"}))]){let t=e.resource.id,r=o.get(t)||{resource:e.resource,scores:{},reasons:new Set};r.scores[e.strategy]=e.score,e.reasons.forEach(e=>r.reasons.add(e)),o.set(t,r)}let n=[],c={"content-based":.3,collaborative:.25,demographic:.2,"ml-predicted":.25};for(let[t,r]of o.entries()){let t=0,a=0;for(let[e,s]of Object.entries(r.scores)){let r=c[e]||0;t+=s*r,a+=r}a>0&&(t/=a,n.push({resource:r.resource,score:t,reasons:Array.from(r.reasons),strategy:"hybrid",urgency:this.calculateUrgency(e.phq4Scores.latest.riskLevel,r.resource.type),estimatedHelpfulness:t}))}return n}findSimilarUsers(e){let t=[];for(let[r,a]of this.userProfiles.entries()){if(a.anonymousId===e.anonymousId)continue;let r=this.calculateUserSimilarity(e,a);r>.3&&t.push({profile:a,similarity:r})}return t.sort((e,t)=>t.similarity-e.similarity).slice(0,20)}calculateUserSimilarity(e,t){let r;return r=0+(1-Math.abs(e.phq4Scores.latest.totalScore-t.phq4Scores.latest.totalScore)/12)*.3,e.demographics.countryOfOrigin===t.demographics.countryOfOrigin&&(r+=.2),e.demographics.ageGroup===t.demographics.ageGroup&&(r+=.15),e.demographics.employmentSector===t.demographics.employmentSector&&(r+=.15),e.demographics.language===t.demographics.language&&(r+=.1),e.demographics.gender===t.demographics.gender&&(r+=.1),Math.min(r,1)}extractUserFeatures(e){return[e.phq4Scores.latest.totalScore/12,e.phq4Scores.latest.depressionScore/6,e.phq4Scores.latest.anxietyScore/6,e.usagePatterns.assessmentFrequency/10,e.usagePatterns.totalSessions/100,e.usagePatterns.sessionDuration/60,this.encodeRiskLevel(e.phq4Scores.latest.riskLevel),this.encodeCategory(e.demographics.ageGroup||"",["18-25","26-35","36-45","46-55","55+"]),this.encodeCategory(e.demographics.countryOfOrigin||"",["Bangladesh","India","Philippines","Indonesia","Myanmar"])]}extractResourceFeatures(e){return[e.effectiveness.averageRating/5,e.effectiveness.completionRate,e.effectiveness.improvementScore/12,e.metadata.duration/120,this.encodeCategory(e.metadata.difficulty,["beginner","intermediate","advanced"]),this.encodeCategory(e.type,["therapy","self-help","peer-support","medication","crisis","wellness"])]}predictResourceFit(e,t){let r=0,a=[];e[3]>.7&&t[5]>.8&&(r+=.4,a.push("Matched based on urgency indicators"));let s=e[4],i=t[4];s>.5&&i>.6&&(r+=.2,a.push("Suitable complexity for active users"));let o=t[0];return r+=.3*o,o>.8&&a.push("Highly effective based on user feedback"),{score:Math.min(r+=.1*Math.random(),1),reasons:a}}calculateUrgency(e,t){return"severe"===e&&"crisis"===t?"urgent":"severe"===e?"high":"moderate"===e?"medium":"low"}estimateHelpfulness(e,t){let r=e.effectiveness.averageRating/5,a=t.phq4Scores.latest.riskLevel;return e.metadata.riskLevels.includes(a)&&(r+=.2),e.metadata.languages.includes(t.demographics.language)&&(r+=.1),Math.min(r,1)}encodeRiskLevel(e){return({minimal:.25,mild:.5,moderate:.75,severe:1})[e]||0}encodeCategory(e,t){let r=t.indexOf(e);return r>=0?(r+1)/t.length:0}getRecommendationStrategy(e,t){if(!t)return"hybrid";let r=Array.from(this.abTests.values()).find(e=>e.active&&e.trafficSplit[t]);return r&&r.variants[t]?r.variants[t].strategy:"hybrid"}applyContextFilters(e,t){let r=e;if(t.includeTypes?.length&&(r=r.filter(e=>t.includeTypes.includes(e.resource.type))),t.excludeTypes?.length&&(r=r.filter(e=>!t.excludeTypes.includes(e.resource.type))),t.urgencyFilter){let e={low:1,medium:2,high:3,urgent:4},a=e[t.urgencyFilter];r=r.filter(t=>e[t.urgency]>=a)}return r}addPersonalizedMessages(e,t){return e.map(e=>{t.phq4Scores.latest.riskLevel;let r=t.demographics.countryOfOrigin,a="";return"urgent"===e.urgency?a="This resource provides immediate support for your current situation.":"collaborative"===e.strategy?a="People with similar backgrounds have found this helpful.":"demographic"===e.strategy&&r?a=`This resource is specifically designed for people from ${r}.`:e.resource.effectiveness.averageRating>4.5&&(a="This is a highly-rated resource that has helped many people."),{...e,personalizedMessage:a}})}logRecommendationMetrics(e,t,r,a){e.forEach((e,s)=>{let i={recommendationId:`rec_${Date.now()}_${s}`,userId:t.anonymousId,timestamp:new Date().toISOString(),strategy:r,abTestGroup:a,resourceId:e.resource.id,score:e.score,position:s,viewed:!1,clicked:!1,completed:!1,triggerContext:"system_generated",userRiskLevel:t.phq4Scores.latest.riskLevel,timeOfDay:new Date().getHours().toString()};this.metrics.push(i)})}trackInteraction(e,t,r){let a=this.metrics.find(t=>t.recommendationId===e);if(a)switch(t){case"view":a.viewed=!0;break;case"click":a.clicked=!0,a.timeToClick=r?.timeToClick;break;case"complete":a.completed=!0,a.engagementDuration=r?.duration;break;case"rate":a.rating=r?.rating,a.helpfulnessRating=r?.helpfulness}}initializeResources(){this.resources=[{id:"res_001",type:"therapy",title:"Multilingual Counseling Services",description:"Professional counseling available in multiple languages for migrant workers",metadata:{languages:["en","zh","bn","ta","my","idn"],culturalContext:["Bangladesh","India","Philippines","Indonesia","Myanmar"],targetDemographics:{employmentSectors:["Construction","Domestic Work","Manufacturing"],countries:["Singapore","Malaysia","UAE","Saudi Arabia"]},riskLevels:["moderate","severe"],tags:["professional","culturally-sensitive","confidential"],difficulty:"beginner",duration:60,format:"individual"},effectiveness:{averageRating:4.3,totalRatings:127,completionRate:.78,improvementScore:3.2},availability:{locations:["Singapore","Malaysia","UAE"],cost:"free",accessRequirements:["appointment"],waitTime:3},provider:{name:"Migrant Mental Health Collective",type:"ngo",credentials:["Licensed Therapists","Cultural Specialists"],contact:{phone:"+65-1234-5678",email:"help@mmhc.org",whatsapp:"+65-1234-5678"}}}]}initializeABTests(){this.abTests.set("recommendation_strategy_test",{id:"recommendation_strategy_test",name:"Recommendation Strategy Comparison",description:"Testing different recommendation approaches",active:!0,trafficSplit:{control:25,ml_enhanced:25,cultural_first:25,collaborative_heavy:25},startDate:"2025-08-01",metrics:["click_through_rate","completion_rate","satisfaction_rating"],variants:{control:{strategy:"content-based",weights:{content:1},parameters:{}},ml_enhanced:{strategy:"ml-predicted",weights:{ml:.6,content:.4},parameters:{exploration_rate:.1}},cultural_first:{strategy:"demographic",weights:{demographic:.6,cultural:.4},parameters:{cultural_weight:2}},collaborative_heavy:{strategy:"hybrid",weights:{collaborative:.5,content:.3,demographic:.2},parameters:{min_similar_users:5}}}})}getAnalytics(e){let t=this.metrics;e&&(t=t.filter(t=>new Date(t.timestamp)>=new Date(e.start)&&new Date(t.timestamp)<=new Date(e.end)));let r=t.length,a=t.filter(e=>e.clicked).length,s=t.filter(e=>e.completed).length,i=new Map;for(let e of["content-based","collaborative","demographic","ml-predicted","hybrid"]){let r=t.filter(t=>t.strategy===e),a=r.filter(e=>e.clicked).length,s=r.filter(e=>e.completed).length,o=r.filter(e=>e.rating).reduce((e,t)=>e+(t.rating||0),0)/r.filter(e=>e.rating).length;i.set(e,{totalRecommendations:r.length,clickThroughRate:r.length>0?a/r.length:0,completionRate:r.length>0?s/r.length:0,averageRating:o||0})}return{overview:{totalRecommendations:r,clickThroughRate:r>0?a/r:0,completionRate:r>0?s/r:0},strategyPerformance:Object.fromEntries(i),abTestResults:this.getABTestResults()}}getABTestResults(){let e=new Map;for(let[t,r]of this.abTests.entries()){let a=this.metrics.filter(e=>e.abTestGroup),s=new Map;for(let e of Object.keys(r.variants)){let t=a.filter(t=>t.abTestGroup===e),r=t.filter(e=>e.clicked).length,i=t.filter(e=>e.completed).length;s.set(e,{sample_size:t.length,click_through_rate:t.length>0?r/t.length:0,completion_rate:t.length>0?i/t.length:0})}e.set(t,{test_name:r.name,status:r.active?"active":"inactive",variants:Object.fromEntries(s)})}return Object.fromEntries(e)}}let s=a}};